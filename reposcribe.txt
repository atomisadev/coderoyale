Project Directory: /home/ubuntu/coderoyalereal
Output File: /home/ubuntu/coderoyalereal/reposcribe.txt
Date: 2025-05-31T15:30:33.938Z

File Tree:
coderoyalereal/
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ button.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ card.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ code.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ turbo/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ generators/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ component.hbs
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ config.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ eslint.config.mjs
‚îÇ   ‚îú‚îÄ‚îÄ eslint-config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ react-internal.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ next.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ   ‚îî‚îÄ‚îÄ typescript-config/
‚îÇ       ‚îú‚îÄ‚îÄ package.json
‚îÇ       ‚îú‚îÄ‚îÄ nextjs.json
‚îÇ       ‚îú‚îÄ‚îÄ react-library.json
‚îÇ       ‚îî‚îÄ‚îÄ base.json
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ web/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ eslint.config.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ next.config.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ globals.css
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fonts/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ .gitignore
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game-screen.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-join-room.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ button.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ badge.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tabs.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scroll-area.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ card.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lobby.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game-socket-provider.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tanstack-provider.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ next-env.d.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ next.svg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cards/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ turborepo-light.svg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ window.svg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vercel.svg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ file-text.svg
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ globe.svg
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ turborepo-dark.svg
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postcss.config.mjs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ utils.ts
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îú‚îÄ‚îÄ Models/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Player.cs
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Problem.cs
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ GameRoom.cs
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ WebSocketMessages.cs
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Judge0Settings.cs
‚îÇ       ‚îú‚îÄ‚îÄ package.json
‚îÇ       ‚îú‚îÄ‚îÄ Controllers/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ GameController.cs
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ JudgeController.cs
‚îÇ       ‚îú‚îÄ‚îÄ MyCsApi.csproj
‚îÇ       ‚îú‚îÄ‚îÄ .gitignore
‚îÇ       ‚îú‚îÄ‚îÄ Item.cs
‚îÇ       ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ       ‚îú‚îÄ‚îÄ MyCsApi.http
‚îÇ       ‚îú‚îÄ‚îÄ Properties/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ launchSettings.json
‚îÇ       ‚îú‚îÄ‚îÄ Program.cs
‚îÇ       ‚îú‚îÄ‚îÄ appsettings.json
‚îÇ       ‚îú‚îÄ‚îÄ appsettings.Development.json
‚îÇ       ‚îú‚îÄ‚îÄ index.ts
‚îÇ       ‚îú‚îÄ‚îÄ Services/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CardManager.cs
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ProblemService.cs
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ RoomManager.cs
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ JudgeService.cs
‚îÇ       ‚îú‚îÄ‚îÄ WebSockets/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ WebSocketMessageHandler.cs
‚îÇ       ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ .npmrc
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ turbo.json
‚îî‚îÄ‚îÄ coderoyalereal.sln



--- File Contents ---

-------------------- package.json (path: package.json) --------------------
{
  "name": "coderoyale",
  "private": true,
  "scripts": {
    "build": "turbo run build",
    "dev": "turbo run dev",
    "lint": "turbo run lint",
    "format": "prettier --write \"**/*.{ts,tsx,md}\"",
    "check-types": "turbo run check-types"
  },
  "devDependencies": {
    "prettier": "^3.5.3",
    "turbo": "^2.5.3",
    "typescript": "5.8.2"
  },
  "engines": {
    "node": ">=18"
  },
  "packageManager": "bun@1.2.13",
  "workspaces": [
    "apps/*",
    "packages/*"
  ]
}
-------------------- END package.json --------------------

-------------------- .gitignore (path: .gitignore) --------------------
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# Dependencies
node_modules
.pnp
.pnp.js

# Local env files
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# Testing
coverage

# Turbo
.turbo

# Vercel
.vercel

# Build Outputs
.next/
out/
build
dist


# Debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Misc
.DS_Store
*.pem

apps/api/obj/
apps/api/bin/
*.ico
*.lock
*.woff
*.png
problems.json

*.AssemblyInfo.cs
*.cache
-------------------- END .gitignore --------------------

-------------------- button.tsx (path: packages/ui/src/button.tsx) --------------------
"use client";

import { ReactNode } from "react";

interface ButtonProps {
  children: ReactNode;
  className?: string;
  appName: string;
}

export const Button = ({ children, className, appName }: ButtonProps) => {
  return (
    <button
      className={className}
      onClick={() => alert(`Hello from your ${appName} app!`)}
    >
      {children}
    </button>
  );
};
-------------------- END button.tsx --------------------

-------------------- card.tsx (path: packages/ui/src/card.tsx) --------------------
import { type JSX } from "react";

export function Card({
  className,
  title,
  children,
  href,
}: {
  className?: string;
  title: string;
  children: React.ReactNode;
  href: string;
}): JSX.Element {
  return (
    <a
      className={className}
      href={`${href}?utm_source=create-turbo&utm_medium=basic&utm_campaign=create-turbo"`}
      rel="noopener noreferrer"
      target="_blank"
    >
      <h2>
        {title} <span>-&gt;</span>
      </h2>
      <p>{children}</p>
    </a>
  );
}
-------------------- END card.tsx --------------------

-------------------- code.tsx (path: packages/ui/src/code.tsx) --------------------
import { type JSX } from "react";

export function Code({
  children,
  className,
}: {
  children: React.ReactNode;
  className?: string;
}): JSX.Element {
  return <code className={className}>{children}</code>;
}
-------------------- END code.tsx --------------------

-------------------- package.json (path: packages/ui/package.json) --------------------
{
  "name": "@repo/ui",
  "version": "0.0.0",
  "private": true,
  "exports": {
    "./*": "./src/*.tsx"
  },
  "scripts": {
    "lint": "eslint . --max-warnings 0",
    "generate:component": "turbo gen react-component",
    "check-types": "tsc --noEmit"
  },
  "devDependencies": {
    "@repo/eslint-config": "*",
    "@repo/typescript-config": "*",
    "@turbo/gen": "^2.5.0",
    "@types/node": "^22.15.3",
    "@types/react": "19.1.0",
    "@types/react-dom": "19.1.1",
    "eslint": "^9.27.0",
    "typescript": "5.8.2"
  },
  "dependencies": {
    "react": "^19.1.0",
    "react-dom": "^19.1.0"
  }
}
-------------------- END package.json --------------------

-------------------- tsconfig.json (path: packages/ui/tsconfig.json) --------------------
{
  "extends": "@repo/typescript-config/react-library.json",
  "compilerOptions": {
    "outDir": "dist"
  },
  "include": ["src"],
  "exclude": ["node_modules", "dist"]
}
-------------------- END tsconfig.json --------------------

-------------------- component.hbs (path: packages/ui/turbo/generators/templates/component.hbs) --------------------
export const {{ pascalCase name }} = ({ children }: { children: React.ReactNode }) => {
  return (
    <div>
      <h1>{{ pascalCase name }} Component</h1>
      {children}
    </div>
  );
};
-------------------- END component.hbs --------------------

-------------------- config.ts (path: packages/ui/turbo/generators/config.ts) --------------------
import type { PlopTypes } from "@turbo/gen";

// Learn more about Turborepo Generators at https://turborepo.com/docs/guides/generating-code

export default function generator(plop: PlopTypes.NodePlopAPI): void {
  // A simple generator to add a new React component to the internal UI library
  plop.setGenerator("react-component", {
    description: "Adds a new react component",
    prompts: [
      {
        type: "input",
        name: "name",
        message: "What is the name of the component?",
      },
    ],
    actions: [
      {
        type: "add",
        path: "src/{{kebabCase name}}.tsx",
        templateFile: "templates/component.hbs",
      },
      {
        type: "append",
        path: "package.json",
        pattern: /"exports": {(?<insertion>)/g,
        template: '    "./{{kebabCase name}}": "./src/{{kebabCase name}}.tsx",',
      },
    ],
  });
}
-------------------- END config.ts --------------------

-------------------- eslint.config.mjs (path: packages/ui/eslint.config.mjs) --------------------
import { config } from "@repo/eslint-config/react-internal";

/** @type {import("eslint").Linter.Config} */
export default config;
-------------------- END eslint.config.mjs --------------------

-------------------- package.json (path: packages/eslint-config/package.json) --------------------
{
  "name": "@repo/eslint-config",
  "version": "0.0.0",
  "type": "module",
  "private": true,
  "exports": {
    "./base": "./base.js",
    "./next-js": "./next.js",
    "./react-internal": "./react-internal.js"
  },
  "devDependencies": {
    "@eslint/js": "^9.27.0",
    "@next/eslint-plugin-next": "^15.3.0",
    "eslint": "^9.27.0",
    "eslint-config-prettier": "^10.1.1",
    "eslint-plugin-only-warn": "^1.1.0",
    "eslint-plugin-react": "^7.37.4",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-turbo": "^2.5.0",
    "globals": "^16.2.0",
    "typescript": "^5.8.2",
    "typescript-eslint": "^8.32.0"
  }
}
-------------------- END package.json --------------------

-------------------- base.js (path: packages/eslint-config/base.js) --------------------
import js from "@eslint/js";
import eslintConfigPrettier from "eslint-config-prettier";
import turboPlugin from "eslint-plugin-turbo";
import tseslint from "typescript-eslint";
import onlyWarn from "eslint-plugin-only-warn";

/**
 * A shared ESLint configuration for the repository.
 *
 * @type {import("eslint").Linter.Config[]}
 * */
export const config = [
  js.configs.recommended,
  eslintConfigPrettier,
  ...tseslint.configs.recommended,
  {
    plugins: {
      turbo: turboPlugin,
    },
    rules: {
      "turbo/no-undeclared-env-vars": "warn",
    },
  },
  {
    plugins: {
      onlyWarn,
    },
  },
  {
    ignores: ["dist/**"],
  },
];
-------------------- END base.js --------------------

-------------------- react-internal.js (path: packages/eslint-config/react-internal.js) --------------------
import js from "@eslint/js";
import eslintConfigPrettier from "eslint-config-prettier";
import tseslint from "typescript-eslint";
import pluginReactHooks from "eslint-plugin-react-hooks";
import pluginReact from "eslint-plugin-react";
import globals from "globals";
import { config as baseConfig } from "./base.js";

/**
 * A custom ESLint configuration for libraries that use React.
 *
 * @type {import("eslint").Linter.Config[]} */
export const config = [
  ...baseConfig,
  js.configs.recommended,
  eslintConfigPrettier,
  ...tseslint.configs.recommended,
  pluginReact.configs.flat.recommended,
  {
    languageOptions: {
      ...pluginReact.configs.flat.recommended.languageOptions,
      globals: {
        ...globals.serviceworker,
        ...globals.browser,
      },
    },
  },
  {
    plugins: {
      "react-hooks": pluginReactHooks,
    },
    settings: { react: { version: "detect" } },
    rules: {
      ...pluginReactHooks.configs.recommended.rules,
      // React scope no longer necessary with new JSX transform.
      "react/react-in-jsx-scope": "off",
    },
  },
];
-------------------- END react-internal.js --------------------

-------------------- next.js (path: packages/eslint-config/next.js) --------------------
import js from "@eslint/js";
import eslintConfigPrettier from "eslint-config-prettier";
import tseslint from "typescript-eslint";
import pluginReactHooks from "eslint-plugin-react-hooks";
import pluginReact from "eslint-plugin-react";
import globals from "globals";
import pluginNext from "@next/eslint-plugin-next";
import { config as baseConfig } from "./base.js";

/**
 * A custom ESLint configuration for libraries that use Next.js.
 *
 * @type {import("eslint").Linter.Config[]}
 * */
export const nextJsConfig = [
  ...baseConfig,
  js.configs.recommended,
  eslintConfigPrettier,
  ...tseslint.configs.recommended,
  {
    ...pluginReact.configs.flat.recommended,
    languageOptions: {
      ...pluginReact.configs.flat.recommended.languageOptions,
      globals: {
        ...globals.serviceworker,
      },
    },
  },
  {
    plugins: {
      "@next/next": pluginNext,
    },
    rules: {
      ...pluginNext.configs.recommended.rules,
      ...pluginNext.configs["core-web-vitals"].rules,
    },
  },
  {
    plugins: {
      "react-hooks": pluginReactHooks,
    },
    settings: { react: { version: "detect" } },
    rules: {
      ...pluginReactHooks.configs.recommended.rules,
      // React scope no longer necessary with new JSX transform.
      "react/react-in-jsx-scope": "off",
    },
  },
];
-------------------- END next.js --------------------

-------------------- README.md (path: packages/eslint-config/README.md) --------------------
# `@turbo/eslint-config`

Collection of internal eslint configurations.
-------------------- END README.md --------------------

-------------------- package.json (path: packages/typescript-config/package.json) --------------------
{
  "name": "@repo/typescript-config",
  "version": "0.0.0",
  "private": true,
  "license": "MIT",
  "publishConfig": {
    "access": "public"
  }
}
-------------------- END package.json --------------------

-------------------- nextjs.json (path: packages/typescript-config/nextjs.json) --------------------
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "extends": "./base.json",
  "compilerOptions": {
    "plugins": [{ "name": "next" }],
    "module": "ESNext",
    "moduleResolution": "Bundler",
    "allowJs": true,
    "jsx": "preserve",
    "noEmit": true
  }
}
-------------------- END nextjs.json --------------------

-------------------- react-library.json (path: packages/typescript-config/react-library.json) --------------------
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "extends": "./base.json",
  "compilerOptions": {
    "jsx": "react-jsx"
  }
}
-------------------- END react-library.json --------------------

-------------------- base.json (path: packages/typescript-config/base.json) --------------------
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "compilerOptions": {
    "declaration": true,
    "declarationMap": true,
    "esModuleInterop": true,
    "incremental": false,
    "isolatedModules": true,
    "lib": ["es2022", "DOM", "DOM.Iterable"],
    "module": "NodeNext",
    "moduleDetection": "force",
    "moduleResolution": "NodeNext",
    "noUncheckedIndexedAccess": true,
    "resolveJsonModule": true,
    "skipLibCheck": true,
    "strict": true,
    "target": "ES2022"
  }
}
-------------------- END base.json --------------------

-------------------- eslint.config.js (path: apps/web/eslint.config.js) --------------------
import { nextJsConfig } from "@repo/eslint-config/next-js";

/** @type {import("eslint").Linter.Config} */
export default nextJsConfig;
-------------------- END eslint.config.js --------------------

-------------------- next.config.js (path: apps/web/next.config.js) --------------------
/** @type {import('next').NextConfig} */
const nextConfig = {};

export default nextConfig;
-------------------- END next.config.js --------------------

-------------------- package.json (path: apps/web/package.json) --------------------
{
  "name": "web",
  "version": "0.1.0",
  "type": "module",
  "private": true,
  "scripts": {
    "dev": "next dev --turbopack --port 3000",
    "build": "next build",
    "start": "next start",
    "lint": "next lint --max-warnings 0",
    "check-types": "tsc --noEmit"
  },
  "dependencies": {
    "@monaco-editor/react": "^4.7.0",
    "@radix-ui/react-scroll-area": "^1.2.9",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-tabs": "^1.1.12",
    "@repo/ui": "*",
    "@tailwindcss/postcss": "^4.1.8",
    "@tanstack/react-query": "^5.79.0",
    "@tanstack/react-query-devtools": "^5.79.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "lucide-react": "^0.511.0",
    "next": "^15.3.0",
    "postcss": "^8.5.4",
    "react": "^19.1.0",
    "react-dom": "^19.1.0",
    "tailwind-merge": "^3.3.0",
    "tailwindcss": "^4.1.8"
  },
  "devDependencies": {
    "@repo/eslint-config": "*",
    "@repo/typescript-config": "*",
    "@types/node": "^22.15.3",
    "@types/react": "19.1.0",
    "@types/react-dom": "19.1.1",
    "eslint": "^9.27.0",
    "tw-animate-css": "^1.3.2",
    "typescript": "5.8.2"
  }
}
-------------------- END package.json --------------------

-------------------- components.json (path: apps/web/components.json) --------------------
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "app/globals.css",
    "baseColor": "zinc",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
-------------------- END components.json --------------------

-------------------- globals.css (path: apps/web/app/globals.css) --------------------
@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

html,
body {
  max-width: 100vw;
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  background-color: #0e0e0e;
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

a {
  color: inherit;
  text-decoration: none;
}

.imgDark {
  display: none;
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }

  .imgLight {
    display: none;
  }
  .imgDark {
    display: unset;
  }
}

@theme inline {
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

:root {
  --radius: 0.625rem;
  --background: #0e0e0e;
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.21 0.006 285.885);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.21 0.006 285.885);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.92 0.004 286.32);
  --primary-foreground: oklch(0.21 0.006 285.885);
  --secondary: oklch(0.274 0.006 286.033);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.274 0.006 286.033);
  --muted-foreground: oklch(0.705 0.015 286.067);
  --accent: oklch(0.274 0.006 286.033);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 10%);
  --input: oklch(1 0 0 / 15%);
  --ring: oklch(0.552 0.016 285.938);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.21 0.006 285.885);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.274 0.006 286.033);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.552 0.016 285.938);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}
-------------------- END globals.css --------------------

-------------------- page.tsx (path: apps/web/app/page.tsx) --------------------
"use client";

import React, { Suspense } from "react";
import { useGameWebSocket } from "../context/game-socket-provider";
import { CreateJoinRoom } from "../components/create-join-room";
import { Lobby } from "../components/lobby";
import { GameScreen } from "../components/game-screen";
import { useSearchParams } from "next/navigation";

function HomePageContent() {
  const {
    isConnected,
    roomCode,
    error: wsError,
    isGameStarted,
  } = useGameWebSocket();
  const searchParams = useSearchParams();
  const roomCodeFromUrl = searchParams.get("roomCode");

  return (
    <div>
      <main>
        {/* <h1>Code Royale</h1> */}
        {!isConnected && (
          <p style={{ color: "orange" }}>Connecting to server...</p>
        )}
        {wsError && <p style={{ color: "red" }}>Connection Error: {wsError}</p>}

        {isConnected && !roomCode && (
          <CreateJoinRoom initialRoomCode={roomCodeFromUrl || undefined} />
        )}

        {isConnected && roomCode && !isGameStarted && <Lobby />}

        {isConnected && roomCode && isGameStarted && <GameScreen />}
      </main>
    </div>
  );
}

export default function Home() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <HomePageContent />
    </Suspense>
  );
}
-------------------- END page.tsx --------------------

-------------------- layout.tsx (path: apps/web/app/layout.tsx) --------------------
import type { Metadata } from "next";
import localFont from "next/font/local";
import "./globals.css";
import { GameWebSocketProvider } from "../context/game-socket-provider";
import { TanstackProvider } from "../context/tanstack-provider";

const geistSans = localFont({
  src: "./fonts/GeistVF.woff",
  variable: "--font-geist-sans",
});
const geistMono = localFont({
  src: "./fonts/GeistMonoVF.woff",
  variable: "--font-geist-mono",
});

export const metadata: Metadata = {
  title: "Code Royale",
  description: "Online coding battle royale game",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body className={`${geistSans.variable} ${geistMono.variable}`}>
        <TanstackProvider>
          <GameWebSocketProvider>{children}</GameWebSocketProvider>
        </TanstackProvider>
      </body>
    </html>
  );
}
-------------------- END layout.tsx --------------------

-------------------- .gitignore (path: apps/web/.gitignore) --------------------
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js
.yarn/install-state.gz

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# env files (can opt-in for commiting if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
-------------------- END .gitignore --------------------

-------------------- tsconfig.json (path: apps/web/tsconfig.json) --------------------
{
  "extends": "@repo/typescript-config/nextjs.json",
  "compilerOptions": {
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "**/*.ts",
    "**/*.tsx",
    "next-env.d.ts",
    "next.config.js",
    ".next/types/**/*.ts"
  ],
  "exclude": ["node_modules"]
}
-------------------- END tsconfig.json --------------------

-------------------- game-screen.tsx (path: apps/web/components/game-screen.tsx) --------------------
"use client";

import React, { useState, useEffect } from "react";
import {
  useGameWebSocket,
  PlayerInfo,
  ProblemDetails, // Assuming TestCase is part of ProblemDetails or imported
  TestCase,     // Make sure TestCase is exported and available
} from "@/context/game-socket-provider";
import Editor from "@monaco-editor/react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";

interface PlayerWithHP extends PlayerInfo {
  hp: number;
}

// Define structure for API communication (matches C# backend)
interface ApiProblemTestCase {
  title: string;
  stdin: string | null; // Allow null if some test cases might not have input
  expectedOutput: string | null; // Allow null
}
interface JudgeApiSubmissionRequest {
  sourceCode: string;
  languageId: number;
  testCases: ApiProblemTestCase[];
}
interface TestCaseExecutionResult {
  title: string;
  passed: boolean;
  actualOutput?: string;
  expectedOutput?: string;
  status: string;
  judge0StatusId: number;
  errorMessage?: string;
  time?: string;
  memory?: number;
}
interface CodeSubmissionResult {
  results: TestCaseExecutionResult[];
  overallStatus: string;
  compilationOutput?: string;
  errorOutput?: string;
}


export const GameScreen: React.FC = () => {
  const {
    playersInGame,
    roomCode,
    playerId,
    error: wsError,
    currentProblem,
    // sendMessage, // We might not need sendMessage for code submission if using HTTP API
  } = useGameWebSocket();

  const [code, setCode] = useState<string>(
    "# Write your Python code here\n# Read input using input()\n# Print output using print()\n\nprint('Hello World!')"
  );
  const [submissionStatus, setSubmissionStatus] = useState<string | null>(null);
  const [isSubmitting, setIsSubmitting] = useState<boolean>(false);
  const [playersWithHP, setPlayersWithHP] = useState<PlayerWithHP[]>([]);
  const [terminalOutput, setTerminalOutput] = useState<string[]>([]);

  useEffect(() => {
    if (playersInGame.length > 0) {
      const playersHP = playersInGame.map((player) => ({
        ...player,
        hp: 100, // Or fetched from context if HP is managed there
      }));
      setPlayersWithHP(playersHP);
    }
  }, [playersInGame]);

  useEffect(() => {
    // Set initial code if problem provides a template, or on new problem
    if (currentProblem?.title) { // Reset for new problem
        // You might want to add a default template to currentProblem or a specific field for it
        // For now, just resetting to default Python starter.
        setCode("# Write your Python code here\n# Read input using input()\n# Print output using print()\n\nprint('Hello World!')");
        setTerminalOutput([`Problem: ${currentProblem.title} loaded.`,'Ready for submission.']);
        setSubmissionStatus(null);
    }
  }, [currentProblem?.title]);


  if (wsError) {
    return (
      <div className="flex items-center justify-center h-screen text-red-500 bg-[#0E0E0E]">
        Error: {wsError}
      </div>
    );
  }

  const handleSubmitCode = async () => {
    if (!currentProblem || !playerId || !code.trim()) return;

    setIsSubmitting(true);
    setSubmissionStatus("Submitting to Judge...");
    setTerminalOutput([`> Submitting code for ${currentProblem.title}...`]);

    const validatorTestCases = currentProblem.testCases?.filter(
      (tc) => tc.isValidator && tc.testIn !== undefined && tc.testOut !== undefined // Ensure testIn/Out are not undefined
    ) || [];

    if (validatorTestCases.length === 0) {
      setTerminalOutput((prev) => [...prev, "> No validator test cases found for this problem."]);
      setSubmissionStatus("No validators");
      setIsSubmitting(false);
      return;
    }

    const apiPayload: JudgeApiSubmissionRequest = {
      sourceCode: code,
      languageId: parseInt(process.env.NEXT_PUBLIC_JUDGE0_PYTHON_LANG_ID || "71"), // Default to Python 3.8
      testCases: validatorTestCases.map((tc, index) => ({
        title: tc.title || `Validator ${index + 1}`,
        stdin: tc.testIn,
        expectedOutput: tc.testOut,
      })),
    };

    try {
      const apiUrl = process.env.NEXT_PUBLIC_API_URL || "http://localhost:5217";
      const response = await fetch(`${apiUrl}/api/judge/submit`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(apiPayload),
      });

      const newTerminalOutput: string[] = [...terminalOutput]; // Start with the "Submitting..." message

      if (!response.ok) {
        const errorData = await response.text();
        newTerminalOutput.push(`> API Error: ${response.status} - ${errorData}`);
        setSubmissionStatus(`API Error: ${response.status}`);
        setTerminalOutput(newTerminalOutput);
        setIsSubmitting(false);
        return;
      }

      const result: CodeSubmissionResult = await response.json();
      newTerminalOutput.push(`> Overall Status: ${result.overallStatus}`);

      if (result.compilationOutput) {
        newTerminalOutput.push(`> Compilation Output:`);
        newTerminalOutput.push(result.compilationOutput);
      }
      if (result.errorOutput && !result.compilationOutput) { // Show general runtime errors if not compilation
        newTerminalOutput.push(`> Execution Error:`);
        newTerminalOutput.push(result.errorOutput);
      }

      result.results.forEach((tcResult) => {
        newTerminalOutput.push("---");
        newTerminalOutput.push(`> Test Case: ${tcResult.title}`);
        newTerminalOutput.push(`> Status: ${tcResult.passed ? "PASSED ‚úÖ" : `FAILED ‚ùå (${tcResult.status})`}`);
        if (!tcResult.passed) {
          newTerminalOutput.push(`> Expected: "${tcResult.expectedOutput}"`);
          newTerminalOutput.push(`> Got: "${tcResult.actualOutput}"`);
          if (tcResult.errorMessage && tcResult.judge0StatusId !== 4) { // Don't show error message if it's just "Wrong Answer"
            newTerminalOutput.push(`> Details: ${tcResult.errorMessage}`);
          }
        }
         if(tcResult.time) newTerminalOutput.push(`> Time: ${tcResult.time}s`);
         if(tcResult.memory) newTerminalOutput.push(`> Memory: ${tcResult.memory} KB`);
      });

      setTerminalOutput(newTerminalOutput);
      setSubmissionStatus(result.overallStatus);
    } catch (error: any) {
      console.error("Error submitting code:", error);
      setTerminalOutput((prev) => [...prev, `> Client-side Error: ${error.message}`]);
      setSubmissionStatus("Client Error");
    } finally {
      setIsSubmitting(false);
    }
  };

  const HPBar: React.FC<{ hp: number }> = ({ hp }) => (
    <div className="w-16 h-2 bg-gray-800 rounded-full overflow-hidden">
      <div
        className={`h-full transition-all duration-300 ${
          hp > 60 ? "bg-green-500" : hp > 30 ? "bg-orange-500" : "bg-red-500"
        }`}
        style={{ width: `${hp}%` }}
      />
    </div>
  );

  // Use currentProblem.testCases directly if they include the "isTest" flag as per your JSON
   const getExampleTestCases = () => {
     if (!currentProblem?.testCases) return [];
     // Filter for example tests (isTest: true)
     return currentProblem.testCases.filter((tc) => tc.isTest);
   };

  const playerCards = [
    { id: 1, name: "Attack", cost: 2, description: "Deal 20 damage" },
    { id: 2, name: "Shield", cost: 1, description: "Block attack" },
    // ... other cards
  ];

  return (
    <div className="h-screen w-screen bg-[#0E0E0E] text-white p-4">
      <div className="grid grid-cols-4 grid-rows-4 gap-4 h-full">
        {/* Problem and Test Cases Card */}
        <Card className="col-span-2 row-span-2 border-gray-700 overflow-hidden flex flex-col">
          <CardHeader className="pb-3 flex-shrink-0">
            <CardTitle className="text-lg p-2">
              {currentProblem?.title || "Loading Problem..."}
            </CardTitle>
          </CardHeader>
          <CardContent className="flex-1 overflow-auto"> {/* Use overflow-auto here */}
            <ScrollArea className="h-full pr-2"> {/* ScrollArea now direct child */}
              {currentProblem ? (
                <div className="space-y-6 ">
                  <div>
                    <h4 className="font-medium mb-3 text-orange-400">Problem Statement:</h4>
                    <p className="whitespace-pre-wrap text-gray-300 text-sm leading-relaxed break-words">
                      {currentProblem.statement}
                    </p>
                  </div>
                  {currentProblem.inputDescription && (
                    <div>
                      <h4 className="font-medium mb-3 text-blue-400">Input:</h4>
                      <p className="whitespace-pre-wrap text-gray-300 text-sm break-words">
                        {currentProblem.inputDescription}
                      </p>
                    </div>
                  )}
                  {currentProblem.outputDescription && (
                     <div>
                       <h4 className="font-medium mb-3 text-green-400">Output:</h4>
                       <p className="whitespace-pre-wrap text-gray-300 text-sm break-words">
                         {currentProblem.outputDescription}
                       </p>
                     </div>
                  )}
                  {currentProblem.constraints && currentProblem.constraints.trim() !== "" && (
                    <div>
                      <h4 className="font-medium mb-3 text-purple-400">Constraints:</h4>
                      <p className="whitespace-pre-wrap text-gray-300 text-sm break-words">
                        {currentProblem.constraints}
                      </p>
                    </div>
                  )}
                  {getExampleTestCases().length > 0 && (
                    <div>
                      <h4 className="font-medium mb-4 text-cyan-400">Examples:</h4>
                      <div className="space-y-4">
                        {getExampleTestCases().map((testCase, index) => (
                          <div key={index} className="space-y-3">
                            <div className="font-medium text-white">Example {index + 1}:</div>
                            <div>
                              <div className="text-sm font-medium text-gray-400 mb-1">Input:</div>
                              <div className="bg-gray-800/60 border border-gray-600 rounded-md p-3">
                                <code className="text-sm text-gray-200 font-mono whitespace-pre-wrap break-words">
                                  {testCase.testIn}
                                </code>
                              </div>
                            </div>
                            <div>
                              <div className="text-sm font-medium text-gray-400 mb-1">Output:</div>
                              <div className="bg-gray-800/60 border border-gray-600 rounded-md p-3">
                                <code className="text-sm text-gray-200 font-mono whitespace-pre-wrap break-words">
                                  {testCase.testOut}
                                </code>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              ) : (
                <p className="text-center text-gray-400">Loading problem or problem not available...</p>
              )}
            </ScrollArea>
          </CardContent>
        </Card>

        {/* Code Editor and Terminal Card */}
        <Card className="col-span-2 row-span-2 border-gray-700 overflow-hidden flex flex-col">
          <CardHeader className="pb-3 flex-shrink-0">
            <div className="flex justify-between items-center">
              <CardTitle className="text-lg">Development Environment</CardTitle>
              <div className="flex gap-3 items-center">
                {submissionStatus && submissionStatus !== "Submitting to Judge..." && (
                  <Badge
                    variant={
                      submissionStatus === "All tests passed!" ? "default"
                      : submissionStatus.includes("Error") || submissionStatus.includes("failed") || submissionStatus.includes("No validators") ? "destructive"
                      : "secondary"
                    }
                  >
                    {submissionStatus}
                  </Badge>
                )}
                <Button
                  onClick={handleSubmitCode}
                  disabled={!currentProblem || !code.trim() || isSubmitting}
                  className="px-4 py-2"
                >
                  {isSubmitting ? "Running Tests..." : "Submit Code"}
                </Button>
              </div>
            </div>
          </CardHeader>
          <CardContent className="flex-1 overflow-hidden">
            <Tabs defaultValue="editor" className="h-full flex flex-col">
              <TabsList className="grid w-full grid-cols-2 mb-3">
                <TabsTrigger value="editor">Code Editor</TabsTrigger>
                <TabsTrigger value="terminal">Terminal</TabsTrigger>
              </TabsList>
              <TabsContent value="editor" className="flex-1 overflow-hidden">
                <div className="h-full border border-gray-600 rounded-lg overflow-hidden">
                  <Editor
                    height="100%"
                    defaultLanguage="python"
                    theme="vs-dark"
                    value={code}
                    onChange={(value) => setCode(value || "")}
                    options={{
                      fontSize: 14, minimap: { enabled: false }, scrollBeyondLastLine: false,
                      automaticLayout: true, tabSize: 4, insertSpaces: true, wordWrap: "on",
                      lineNumbers: "on", padding: { top: 16, bottom: 16 },
                    }}
                  />
                </div>
              </TabsContent>
              <TabsContent value="terminal" className="flex-1 overflow-hidden">
                <div className="h-full border border-gray-600 rounded-lg bg-black p-4 overflow-auto"> {/* Use overflow-auto */}
                  <ScrollArea className="h-full"> {/* ScrollArea direct child */}
                    <div className="font-mono text-sm space-y-1 whitespace-pre-wrap break-words">
                      {terminalOutput.length === 0 ? (
                        <p className="text-gray-400">Terminal output will appear here...</p>
                      ) : (
                        terminalOutput.map((line, index) => (
                          <div
                            key={index}
                            className={`${
                              line.includes("PASSED ‚úÖ") ? "text-green-400"
                              : line.includes("FAILED ‚ùå") || line.toLowerCase().includes("error") ? "text-red-400"
                              : line.startsWith(">") ? "text-blue-400"
                              : "text-gray-300"
                            }`}
                          >
                            {line}
                          </div>
                        ))
                      )}
                    </div>
                  </ScrollArea>
                </div>
              </TabsContent>
            </Tabs>
          </CardContent>
        </Card>

        {/* Players Card - ensure it's flex-col and CardContent is overflow-auto */}
        <Card className="col-span-2 row-span-2 border-gray-700 overflow-hidden flex flex-col">
            <CardHeader className="pb-3 flex-shrink-0">
                <CardTitle className="text-lg">Players ({playersWithHP.length}/10)</CardTitle>
            </CardHeader>
            <CardContent className="flex-1 overflow-auto">
                <ScrollArea className="h-full pr-2">
                    <div className="space-y-3">
                        {playersWithHP.map((player) => (
                            <div
                                key={player.id}
                                className={`p-3 border rounded-lg transition-colors ${
                                player.id === playerId
                                    ? "bg-blue-900/30 border-blue-600"
                                    : "bg-gray-800/30 border-gray-600"
                                }`}
                            >
                                <div className="flex justify-between items-center">
                                <div className="flex flex-col gap-1">
                                    <span className="font-medium">
                                    {player.name} {player.id === playerId ? "(You)" : ""}
                                    </span>
                                    <div className="flex items-center gap-2">
                                    <HPBar hp={player.hp} />
                                    <span className="text-xs text-gray-400">{player.hp} HP</span>
                                    </div>
                                </div>
                                <Badge variant="outline" className="text-xs">
                                    Rank #{Math.floor(Math.random() * 10) + 1}
                                </Badge>
                                </div>
                            </div>
                        ))}
                        {Array.from({ length: Math.max(0, 10 - playersWithHP.length) }).map((_, index) => (
                            <div key={`empty-${index}`} className="p-3 border border-dashed border-gray-600 rounded-lg opacity-50">
                                <div className="flex justify-between items-center">
                                <div className="flex flex-col gap-1">
                                    <span className="text-gray-500">Empty Slot</span>
                                    <div className="flex items-center gap-2">
                                    <HPBar hp={0} />
                                    <span className="text-xs text-gray-500">0 HP</span>
                                    </div>
                                </div>
                                <Badge variant="outline" className="text-xs opacity-50">Waiting...</Badge>
                                </div>
                            </div>
                        ))}
                    </div>
                </ScrollArea>
            </CardContent>
        </Card>


        {/* Hand of Cards */}
        <div className="col-span-2 row-span-2 border border-gray-700 rounded-lg overflow-hidden">
          <div className="px-6 py-4 border-b border-gray-700">
            <h3 className="text-lg font-semibold">Your Hand</h3>
          </div>
          <div className="flex-1 flex items-end justify-center p-8 overflow-auto"> {/* Added overflow-auto here too for safety */}
            <div className="relative flex items-end justify-center">
              {playerCards.map((card, index) => (
                <div
                  key={card.id}
                  className="relative group cursor-pointer transition-all duration-300 ease-out"
                  style={{
                    transform: `
                      translateX(${(index - (playerCards.length -1)/2) * 50}px) 
                      rotate(${(index - (playerCards.length -1)/2) * 8}deg)
                      translateY(${Math.abs(index - (playerCards.length -1)/2) * 12}px)
                    `,
                    zIndex: index + 1,
                  }}
                >
                  <div
                    className="w-32 h-48 border-2 border-gray-600 rounded-lg p-3 shadow-lg transition-all duration-300 group-hover:border-blue-500 group-hover:shadow-blue-500/20 group-hover:scale-110 group-hover:-translate-y-8 group-hover:rotate-0 group-hover:z-50 backdrop-blur-sm bg-gray-800/70" // Added bg
                    style={{ transformOrigin: "bottom center" }}
                  >
                    <div className="flex justify-between items-start mb-2">
                      <h4 className="text-sm font-bold text-white leading-tight">{card.name}</h4>
                      <div className="bg-blue-600 text-white text-xs px-1.5 py-0.5 rounded-full font-bold">
                        {card.cost}‚ö°
                      </div>
                    </div>
                    <div className="flex-1 flex items-center justify-center mb-2">
                      <div className="w-16 h-16 bg-gray-700/50 rounded-lg flex items-center justify-center">
                        <span className="text-2xl">
                          {card.name === "Attack" ? "‚öîÔ∏è" : card.name === "Shield" ? "üõ°Ô∏è" : card.name === "Heal" ? "‚ù§Ô∏è" : card.name === "Boost" ? "‚ö°" : "üîß"}
                        </span>
                      </div>
                    </div>
                    <p className="text-xs text-gray-300 text-center leading-tight">{card.description}</p>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>

      <div className="fixed top-4 right-4">
        <Badge variant="outline" className="bg-gray-900/80 border-gray-600">
          Room: {roomCode}
        </Badge>
      </div>
    </div>
  );
};
-------------------- END game-screen.tsx --------------------

-------------------- create-join-room.tsx (path: apps/web/components/create-join-room.tsx) --------------------
"use client";

import React, { useState, useEffect } from "react";
import { useMutation } from "@tanstack/react-query";
import { useGameWebSocket } from "../context/game-socket-provider";
import { Button } from "@/components/ui/button";

interface CreateJoinRoomProps {
  initialRoomCode?: string;
}

export const CreateJoinRoom: React.FC<CreateJoinRoomProps> = ({
  initialRoomCode,
}) => {
  const { sendMessage, error, setExternalRoomCode } = useGameWebSocket() as any;
  const [playerName, setPlayerName] = useState("");
  const [inputRoomCode, setInputRoomCode] = useState(initialRoomCode || "");

  useEffect(() => {
    if (initialRoomCode && !inputRoomCode) {
      setInputRoomCode(initialRoomCode.toUpperCase());
    }
  }, [initialRoomCode, inputRoomCode]);

  const createRoomMutation = useMutation({
    mutationFn: async (name: string) => {
      if (!name.trim()) {
        throw new Error("Player name cannot be empty.");
      }
      sendMessage("createRoom", { playerName: name });
    },
    onError: (err: Error) => {
      console.error("Create room error:", err.message);
    },
  });

  const joinRoomMutation = useMutation({
    mutationFn: async (params: { name: string; code: string }) => {
      if (!params.name.trim()) {
        throw new Error("Player name cannot be empty.");
      }
      if (!params.code.trim()) {
        throw new Error("Room code cannot be empty.");
      }
      // setExternalRoomCode(params.code); // this caused me so many fucking problems
      sendMessage("joinRoom", {
        playerName: params.name,
        roomCode: params.code,
      });
    },
    onError: (err: Error) => {
      console.error("Join room error:", err.message);
    },  
  });

  const handleCreateRoom = () => {
    createRoomMutation.mutate(playerName);
  };

  const handleJoinRoom = () => {
    joinRoomMutation.mutate({ name: playerName, code: inputRoomCode });
  };

  return (
    <div
      style={{
        display: "flex",
        flexDirection: "column",
        gap: "20px",
        alignItems: "center",
        padding: "20px",
      }}
    >
      <h2>Code Royale</h2>
      <div>
        <label htmlFor="playerName">Player Name: </label>
        <input
          id="playerName"
          type="text"
          value={playerName}
          onChange={(e) => setPlayerName(e.target.value)}
          placeholder="Enter your name"
          style={{ padding: "8px", marginRight: "10px", color: "black" }}
        />
      </div>

      <div style={{ display: "flex", gap: "10px", alignItems: "center" }}>
        <Button
          onClick={handleCreateRoom}
          disabled={createRoomMutation.isPending || !playerName.trim()}
        >
          {createRoomMutation.isPending ? "Creating..." : "Create Room"}
        </Button>
      </div>

      <div
        style={{
          borderTop: "1px solid #ccc",
          paddingTop: "20px",
          marginTop: "20px",
          width: "100%",
          textAlign: "center",
        }}
      >
        <p>Or Join an Existing Room:</p>
        <input
          type="text"
          value={inputRoomCode}
          onChange={(e) => setInputRoomCode(e.target.value.toUpperCase())}
          placeholder="Enter Room Code"
          maxLength={5}
          style={{ padding: "8px", marginRight: "10px", color: "black" }}
        />
        <Button
          onClick={handleJoinRoom}
          disabled={
            joinRoomMutation.isPending ||
            !playerName.trim() ||
            !inputRoomCode.trim()
          }
        >
          {joinRoomMutation.isPending ? "Joining..." : "Join Room"}
        </Button>
      </div>

      {(createRoomMutation.error || joinRoomMutation.error || error) && (
        <p style={{ color: "red", marginTop: "10px" }}>
          Error:{" "}
          {createRoomMutation.error?.message ||
            joinRoomMutation.error?.message ||
            error}
        </p>
      )}
    </div>
  );
};
-------------------- END create-join-room.tsx --------------------

-------------------- button.tsx (path: apps/web/components/ui/button.tsx) --------------------
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default:
          "bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",
        destructive:
          "bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }
-------------------- END button.tsx --------------------

-------------------- badge.tsx (path: apps/web/components/ui/badge.tsx) --------------------
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<"span"> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "span"

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }
-------------------- END badge.tsx --------------------

-------------------- tabs.tsx (path: apps/web/components/ui/tabs.tsx) --------------------
"use client"

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

function Tabs({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      className={cn("flex flex-col gap-2", className)}
      {...props}
    />
  )
}

function TabsList({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",
        className
      )}
      {...props}
    />
  )
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn("flex-1 outline-none", className)}
      {...props}
    />
  )
}

export { Tabs, TabsList, TabsTrigger, TabsContent }
-------------------- END tabs.tsx --------------------

-------------------- scroll-area.tsx (path: apps/web/components/ui/scroll-area.tsx) --------------------
"use client"

import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

function ScrollArea({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
  return (
    <ScrollAreaPrimitive.Root
      data-slot="scroll-area"
      className={cn("relative", className)}
      {...props}
    >
      <ScrollAreaPrimitive.Viewport
        data-slot="scroll-area-viewport"
        className="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1"
      >
        {children}
      </ScrollAreaPrimitive.Viewport>
      <ScrollBar />
      <ScrollAreaPrimitive.Corner />
    </ScrollAreaPrimitive.Root>
  )
}

function ScrollBar({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
  return (
    <ScrollAreaPrimitive.ScrollAreaScrollbar
      data-slot="scroll-area-scrollbar"
      orientation={orientation}
      className={cn(
        "flex touch-none p-px transition-colors select-none",
        orientation === "vertical" &&
          "h-full w-2.5 border-l border-l-transparent",
        orientation === "horizontal" &&
          "h-2.5 flex-col border-t border-t-transparent",
        className
      )}
      {...props}
    >
      <ScrollAreaPrimitive.ScrollAreaThumb
        data-slot="scroll-area-thumb"
        className="bg-border relative flex-1 rounded-full"
      />
    </ScrollAreaPrimitive.ScrollAreaScrollbar>
  )
}

export { ScrollArea, ScrollBar }
-------------------- END scroll-area.tsx --------------------

-------------------- card.tsx (path: apps/web/components/ui/card.tsx) --------------------
import * as React from "react"

import { cn } from "@/lib/utils"

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
        className
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6", className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}
-------------------- END card.tsx --------------------

-------------------- lobby.tsx (path: apps/web/components/lobby.tsx) --------------------
"use client";

import React, { useState, useEffect } from "react";
import { useGameWebSocket, PlayerInfo } from "../context/game-socket-provider";
import { Button } from "@/components/ui/button";

export const Lobby: React.FC = () => {
  const {
    roomCode,
    playersInLobby,
    playerName,
    playerId,
    hostPlayerId,
    sendMessage,
    isGameStarted,
  } = useGameWebSocket();
  const [shareableLink, setShareableLink] = useState("");
  const [linkCopied, setLinkCopied] = useState(false);

  useEffect(() => {
    if (roomCode && typeof window !== "undefined") {
      setShareableLink(`${window.location.origin}/?roomCode=${roomCode}`);
    }
  }, [roomCode]);

  if (isGameStarted) {
    return null;
  }

  if (!roomCode) {
    return <div>Error: Not in a room.</div>;
  }

  const handleCopyLink = async () => {
    if (navigator.clipboard && shareableLink) {
      try {
        await navigator.clipboard.writeText(shareableLink);
        setLinkCopied(true);
        setTimeout(() => setLinkCopied(false), 2000); // Reset after 2 seconds
      } catch (err) {
        console.error("Failed to copy link: ", err);
        alert("Failed to copy link. Please copy it manually.");
      }
    } else {
      alert("Clipboard API not available. Please copy the link manually.");
    }
  };

  const handleStartGame = () => {
    sendMessage("startGame", {});
  };

  const isHost = playerId === hostPlayerId;

  return (
    <div
      style={{
        padding: "20px",
        border: "1px solid #ccc",
        borderRadius: "8px",
        maxWidth: "500px",
        margin: "20px auto",
        textAlign: "center",
      }}
    >
      <h2>Lobby</h2>
      <p>
        <strong>Welcome, {playerName || playerId}!</strong>
      </p>
      <p>
        Room Code:{" "}
        <strong style={{ fontSize: "1.5em", color: "#007bff" }}>
          {roomCode}
        </strong>
      </p>

      {shareableLink && (
        <div style={{ marginTop: "15px", marginBottom: "15px" }}>
          <p>Share this link to invite others:</p>
          <input
            type="text"
            value={shareableLink}
            readOnly
            style={{
              width: "80%",
              padding: "8px",
              marginRight: "10px",
              color: "black",
              border: "1px solid #ccc",
              borderRadius: "4px",
            }}
            onFocus={(e) => e.target.select()}
          />
          <Button onClick={handleCopyLink} variant="outline" size="sm">
            {linkCopied ? "Copied!" : "Copy Link"}
          </Button>
        </div>
      )}

      <h3 style={{ marginTop: "20px" }}>
        Players in Lobby ({playersInLobby.length}/10):
      </h3>
      <ul style={{ listStyleType: "none", padding: 0 }}>
        {playersInLobby.map((player: PlayerInfo) => (
          <li
            key={player.id}
            style={{
              padding: "5px 0",
              borderBottom: "1px dashed #eee",
              textAlign: "left",
              paddingLeft: "20px",
            }}
          >
            {player.name} {player.id === playerId ? "(You)" : ""}
          </li>
        ))}
      </ul>

      {isHost && playersInLobby.length >= 1 && (
        <Button
          onClick={handleStartGame}
          style={{ marginTop: "20px" }}
          disabled={isGameStarted}
        >
          Start Game
        </Button>
      )}
    </div>
  );
};
-------------------- END lobby.tsx --------------------

-------------------- game-socket-provider.tsx (path: apps/web/context/game-socket-provider.tsx) --------------------
"use client";

import React, {
  createContext,
  useContext,
  useEffect,
  useRef,
  useState,
  useCallback,
} from "react";

export interface PlayerInfo {
  id: string;
  name: string;
  hp?: number;
}

export interface TestCase {
  title: string;
  isTest: boolean;
  testIn: string;
  testOut: string;
  isValidator: boolean;
  needValidation?: boolean;
}

export interface ProblemDetails {
  title: string;
  statement: string;
  inputDescription: string;
  outputDescription: string;
  constraints: string | null;
  testCases?: TestCase[];
}

interface GameWebSocketState {
  isConnected: boolean;
  roomCode: string | null;
  gameId: string | null;
  playerId: string | null;
  playerName: string | null;
  playersInLobby: PlayerInfo[];
  error: string | null;
  sendMessage: (type: string, payload: any) => void;
  isGameStarted: boolean;
  playersInGame: PlayerInfo[];
  hostPlayerId: string | null;
  currentProblem: ProblemDetails | null;
  setExternalRoomCode: (code: string | null) => void;
}

const GameWebSocketContext = createContext<GameWebSocketState | undefined>(
  undefined
);

const WEBSOCKET_URL =
  process.env.NEXT_PUBLIC_WEBSOCKET_URL || "ws://localhost:5217/ws";

export const GameWebSocketProvider: React.FC<{ children: React.ReactNode }> = ({
  children,
}) => {
  const [isConnected, setIsConnected] = useState(false);
  const [roomCode, setRoomCode] = useState<string | null>(null);
  const [gameId, setGameId] = useState<string | null>(null);
  const [playerId, setPlayerId] = useState<string | null>(null);
  const [playerName, setPlayerNameState] = useState<string | null>(null);
  const [playersInLobby, setPlayersInLobby] = useState<PlayerInfo[]>([]);
  const [error, setError] = useState<string | null>(null);
  const socketRef = useRef<WebSocket | null>(null);

  const [isGameStarted, setIsGameStarted] = useState(false);
  const [playersInGame, setPlayersInGame] = useState<PlayerInfo[]>([]);
  const [hostPlayerId, setHostPlayerId] = useState<string | null>(null);
  const [currentProblem, setCurrentProblem] = useState<ProblemDetails | null>(
    null
  );

  const connect = useCallback(() => {
    if (socketRef.current && socketRef.current.readyState === WebSocket.OPEN) {
      console.log("WebSocket already open.");
      return;
    }

    console.log(`Attempting to connect to WebSocket at ${WEBSOCKET_URL}...`);
    const socket = new WebSocket(WEBSOCKET_URL);
    socketRef.current = socket;

    socket.onopen = () => {
      console.log("WebSocket connected");
      setIsConnected(true);
      setError(null);
    };

    socket.onmessage = (event) => {
      console.log("WebSocket message received:", event.data);
      try {
        const message = JSON.parse(event.data as string);
        switch (message.type) {
          case "roomCreated":
            setRoomCode(message.payload.roomCode);
            setPlayerId(message.payload.playerId);
            setPlayerNameState(message.payload.playerName);
            setGameId(message.payload.gameId);
            setHostPlayerId(message.payload.hostPlayerId);
            setPlayersInLobby([
              {
                id: message.payload.playerId,
                name: message.payload.playerName,
                hp: 100,
              },
            ]);
            setIsGameStarted(false);
            setPlayersInGame([]);
            setCurrentProblem(null);
            setError(null);
            break;
          case "joinSuccess":
            setRoomCode(message.payload.roomCode);
            setPlayerId(message.payload.playerId);
            setPlayerNameState(message.payload.playerName);
            setGameId(message.payload.gameId);
            setHostPlayerId(message.payload.hostPlayerId);
            const selfPlayer: PlayerInfo = {
              id: message.payload.playerId,
              name: message.payload.playerName,
              hp: 100,
            };
            const otherPlayers = (message.payload.playersInLobby ||
              []) as PlayerInfo[];
            setPlayersInLobby([selfPlayer, ...otherPlayers]);
            setIsGameStarted(false);
            setPlayersInGame([]);
            setCurrentProblem(null);
            setError(null);
            break;
          case "joinFailed":
            setError(message.payload.reason);
            setRoomCode(null);
            setGameId(null);
            setPlayerId(null);
            setCurrentProblem(null);
            break;
          case "playerJoinedLobby":
            setPlayersInLobby((prevPlayers: any) => {
              if (
                !prevPlayers.find((p: any) => p.id === message.payload.playerId)
              ) {
                return [
                  ...prevPlayers,
                  {
                    id: message.payload.playerId,
                    name: message.payload.playerName,
                    hp: 100,
                  },
                ];
              }
              return prevPlayers;
            });
            break;
          case "playerLeftLobby":
            setPlayersInLobby((prevPlayers) =>
              prevPlayers.filter((p) => p.id !== message.payload.playerId)
            );
            if (isGameStarted) {
              setPlayersInGame((prevPlayers) =>
                prevPlayers.filter((p) => p.id !== message.payload.playerId)
              );
            }
            break;
          case "gameStarted":
            setIsGameStarted(true);
            const playersWithHp = (
              message.payload.playersInGame as Omit<PlayerInfo, "hp">[]
            ).map((player) => ({
              ...player,
              hp: 100,
            }));
            setPlayersInGame(playersWithHp);
            setPlayersInLobby([]);
            setCurrentProblem(null);
            setError(null);
            break;
          case "playerHpUpdate":
            setPlayersInGame((prevPlayers) =>
              prevPlayers.map((player) =>
                player.id === message.payload.playerId
                  ? { ...player, hp: message.payload.hp }
                  : player
              )
            );
            break;
          case "newProblem":
            if (message.payload) {
              setCurrentProblem({
                title: message.payload.title,
                statement: message.payload.statement,
                inputDescription: message.payload.inputDescription,
                outputDescription: message.payload.outputDescription,
                constraints: message.payload.constraints,
                testCases: message.payload.testCases || [],
              });
            }
            break;
          default:
            console.warn("Unhandled WebSocket message type:", message.type);
        }
      } catch (e) {
        console.error("Failed to parse WebSocket message or handle it:", e);
        setError("Received an invalid message from the server.");
      }
    };

    socket.onerror = (err) => {
      console.error("WebSocket error:", err);
      setError(
        "WebSocket connection error. Ensure the server is running and accessible."
      );
      setIsConnected(false);
    };

    socket.onclose = (event) => {
      console.log("WebSocket disconnected:", event.reason, event.code);
      setIsConnected(false);

      setRoomCode(null);
      setGameId(null);
      setPlayerId(null);
      setPlayerNameState(null);
      setPlayersInLobby([]);
      setHostPlayerId(null);
      setIsGameStarted(false);
      setPlayersInGame([]);
      setCurrentProblem(null);
      if (!event.wasClean) {
        setError("WebSocket connection closed unexpectedly. Please try again.");
      }
    };
  }, []);

  useEffect(() => {
    connect();
    return () => {
      socketRef.current?.close();
    };
  }, [connect]);

  const sendMessage = (type: string, payload: any) => {
    if (socketRef.current && socketRef.current.readyState === WebSocket.OPEN) {
      const message = JSON.stringify({ type, payload });
      console.log("Sending WebSocket message:", message);
      socketRef.current.send(message);
    } else {
      console.error("WebSocket is not connected.");
      setError(
        "Cannot send message: WebSocket is not connected. Please wait or try reconnecting."
      );
      if (
        !socketRef.current ||
        socketRef.current.readyState === WebSocket.CLOSED
      ) {
        console.log(
          "Attempting to reconnect due to send message on closed socket..."
        );
      }
    }
  };

  const setExternalRoomCodeCallback = useCallback((code: string | null) => {
    if (code) {
      //maybe reset player id or sm
    } else {
      setGameId(null);
      setPlayerId(null);
      setPlayerNameState(null);
      setPlayersInLobby([]);
      setHostPlayerId(null);
      setIsGameStarted(false);
      setPlayersInGame([]);
      setCurrentProblem(null);
    }
  }, []);

  const state = {
    isConnected,
    roomCode,
    gameId,
    playerId,
    playerName,
    playersInLobby,
    error,
    sendMessage,
    isGameStarted,
    playersInGame,
    hostPlayerId,
    currentProblem,
    setExternalRoomCode: setExternalRoomCodeCallback,
  };

  return (
    <GameWebSocketContext.Provider value={state}>
      {children}
    </GameWebSocketContext.Provider>
  );
};

export const useGameWebSocket = () => {
  const context = useContext(GameWebSocketContext);
  if (context === undefined) {
    throw new Error(
      "useGameWebSocket must be used within a GameWebSocketProvider"
    );
  }
  return context;
};
-------------------- END game-socket-provider.tsx --------------------

-------------------- tanstack-provider.tsx (path: apps/web/context/tanstack-provider.tsx) --------------------
"use client";

import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { ReactQueryDevtools } from "@tanstack/react-query-devtools";
import React, { useState } from "react";

export const TanstackProvider: React.FC<{ children: React.ReactNode }> = ({
  children,
}) => {
  const [queryClient] = useState(() => new QueryClient());

  return (
    <QueryClientProvider client={queryClient}>
      {children}
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  );
};
-------------------- END tanstack-provider.tsx --------------------

-------------------- next-env.d.ts (path: apps/web/next-env.d.ts) --------------------
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.
-------------------- END next-env.d.ts --------------------

-------------------- next.svg (path: apps/web/public/next.svg) --------------------
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
-------------------- END next.svg --------------------

-------------------- turborepo-light.svg (path: apps/web/public/turborepo-light.svg) --------------------
<svg width="473" height="76" viewBox="0 0 473 76" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M130.998 30.6566V22.3773H91.0977V30.6566H106.16V58.1876H115.935V30.6566H130.998Z" fill="white"/>
<path d="M153.542 58.7362C165.811 58.7362 172.544 52.5018 172.544 42.2276V22.3773H162.768V41.2799C162.768 47.0156 159.776 50.2574 153.542 50.2574C147.307 50.2574 144.315 47.0156 144.315 41.2799V22.3773H134.539V42.2276C134.539 52.5018 141.272 58.7362 153.542 58.7362Z" fill="white"/>
<path d="M187.508 46.3173H197.234L204.914 58.1876H216.136L207.458 45.2699C212.346 43.5243 215.338 39.6341 215.338 34.3473C215.338 26.6666 209.603 22.3773 200.874 22.3773H177.732V58.1876H187.508V46.3173ZM187.508 38.5867V30.5568H200.376C203.817 30.5568 205.712 32.0531 205.712 34.5967C205.712 36.9907 203.817 38.5867 200.376 38.5867H187.508Z" fill="white"/>
<path d="M219.887 58.1876H245.472C253.452 58.1876 258.041 54.3971 258.041 48.0629C258.041 43.8236 255.348 40.9308 252.156 39.6341C254.35 38.5867 257.043 36.0929 257.043 32.1528C257.043 25.8187 252.555 22.3773 244.625 22.3773H219.887V58.1876ZM229.263 36.3922V30.3074H243.627C246.32 30.3074 247.817 31.3548 247.817 33.3498C247.817 35.3448 246.32 36.3922 243.627 36.3922H229.263ZM229.263 43.7238H244.525C247.168 43.7238 248.615 45.0206 248.615 46.9657C248.615 48.9108 247.168 50.2076 244.525 50.2076H229.263V43.7238Z" fill="white"/>
<path d="M281.942 21.7788C269.423 21.7788 260.396 29.6092 260.396 40.2824C260.396 50.9557 269.423 58.7861 281.942 58.7861C294.461 58.7861 303.438 50.9557 303.438 40.2824C303.438 29.6092 294.461 21.7788 281.942 21.7788ZM281.942 30.2576C288.525 30.2576 293.463 34.1478 293.463 40.2824C293.463 46.4171 288.525 50.3073 281.942 50.3073C275.359 50.3073 270.421 46.4171 270.421 40.2824C270.421 34.1478 275.359 30.2576 281.942 30.2576Z" fill="white"/>
<path d="M317.526 46.3173H327.251L334.932 58.1876H346.154L337.476 45.2699C342.364 43.5243 345.356 39.6341 345.356 34.3473C345.356 26.6666 339.62 22.3773 330.892 22.3773H307.75V58.1876H317.526V46.3173ZM317.526 38.5867V30.5568H330.394C333.835 30.5568 335.73 32.0531 335.73 34.5967C335.73 36.9907 333.835 38.5867 330.394 38.5867H317.526Z" fill="white"/>
<path d="M349.904 22.3773V58.1876H384.717V49.9083H359.48V44.0729H381.874V35.9932H359.48V30.6566H384.717V22.3773H349.904Z" fill="white"/>
<path d="M399.204 46.7662H412.221C420.95 46.7662 426.685 42.5767 426.685 34.5967C426.685 26.5668 420.95 22.3773 412.221 22.3773H389.428V58.1876H399.204V46.7662ZM399.204 38.6366V30.5568H411.673C415.164 30.5568 417.059 32.0531 417.059 34.5967C417.059 37.0904 415.164 38.6366 411.673 38.6366H399.204Z" fill="white"/>
<path d="M450.948 21.7788C438.43 21.7788 429.402 29.6092 429.402 40.2824C429.402 50.9557 438.43 58.7861 450.948 58.7861C463.467 58.7861 472.444 50.9557 472.444 40.2824C472.444 29.6092 463.467 21.7788 450.948 21.7788ZM450.948 30.2576C457.532 30.2576 462.469 34.1478 462.469 40.2824C462.469 46.4171 457.532 50.3073 450.948 50.3073C444.365 50.3073 439.427 46.4171 439.427 40.2824C439.427 34.1478 444.365 30.2576 450.948 30.2576Z" fill="white"/>
<path d="M38.5017 18.0956C27.2499 18.0956 18.0957 27.2498 18.0957 38.5016C18.0957 49.7534 27.2499 58.9076 38.5017 58.9076C49.7535 58.9076 58.9077 49.7534 58.9077 38.5016C58.9077 27.2498 49.7535 18.0956 38.5017 18.0956ZM38.5017 49.0618C32.6687 49.0618 27.9415 44.3346 27.9415 38.5016C27.9415 32.6686 32.6687 27.9414 38.5017 27.9414C44.3347 27.9414 49.0619 32.6686 49.0619 38.5016C49.0619 44.3346 44.3347 49.0618 38.5017 49.0618Z" fill="white"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M40.2115 14.744V7.125C56.7719 8.0104 69.9275 21.7208 69.9275 38.5016C69.9275 55.2824 56.7719 68.989 40.2115 69.8782V62.2592C52.5539 61.3776 62.3275 51.0644 62.3275 38.5016C62.3275 25.9388 52.5539 15.6256 40.2115 14.744ZM20.5048 54.0815C17.233 50.3043 15.124 45.4935 14.7478 40.2115H7.125C7.5202 47.6025 10.4766 54.3095 15.1088 59.4737L20.501 54.0815H20.5048ZM36.7916 69.8782V62.2592C31.5058 61.883 26.695 59.7778 22.9178 56.5022L17.5256 61.8944C22.6936 66.5304 29.4006 69.483 36.7878 69.8782H36.7916Z" fill="url(#paint0_linear_2028_477)"/>
<defs>
<linearGradient id="paint0_linear_2028_477" x1="41.443" y1="11.5372" x2="10.5567" y2="42.4236" gradientUnits="userSpaceOnUse">
<stop stop-color="#0096FF"/>
<stop offset="1" stop-color="#FF1E56"/>
</linearGradient>
</defs>
</svg>
-------------------- END turborepo-light.svg --------------------

-------------------- window.svg (path: apps/web/public/window.svg) --------------------
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5H14.5V12.5C14.5 13.0523 14.0523 13.5 13.5 13.5H2.5C1.94772 13.5 1.5 13.0523 1.5 12.5V2.5ZM0 1H1.5H14.5H16V2.5V12.5C16 13.8807 14.8807 15 13.5 15H2.5C1.11929 15 0 13.8807 0 12.5V2.5V1ZM3.75 5.5C4.16421 5.5 4.5 5.16421 4.5 4.75C4.5 4.33579 4.16421 4 3.75 4C3.33579 4 3 4.33579 3 4.75C3 5.16421 3.33579 5.5 3.75 5.5ZM7 4.75C7 5.16421 6.66421 5.5 6.25 5.5C5.83579 5.5 5.5 5.16421 5.5 4.75C5.5 4.33579 5.83579 4 6.25 4C6.66421 4 7 4.33579 7 4.75ZM8.75 5.5C9.16421 5.5 9.5 5.16421 9.5 4.75C9.5 4.33579 9.16421 4 8.75 4C8.33579 4 8 4.33579 8 4.75C8 5.16421 8.33579 5.5 8.75 5.5Z" fill="#666666"/>
</svg>
-------------------- END window.svg --------------------

-------------------- vercel.svg (path: apps/web/public/vercel.svg) --------------------
<svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_977_547)">
<path fill-rule="evenodd" clip-rule="evenodd" d="M10.5 3L18.5 17H2.5L10.5 3Z" fill="white"/>
</g>
<defs>
<clipPath id="clip0_977_547">
<rect width="16" height="16" fill="white" transform="translate(2.5 2)"/>
</clipPath>
</defs>
</svg>
-------------------- END vercel.svg --------------------

-------------------- file-text.svg (path: apps/web/public/file-text.svg) --------------------
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 13.5V6.5V5.41421C14.5 5.149 14.3946 4.89464 14.2071 4.70711L9.79289 0.292893C9.60536 0.105357 9.351 0 9.08579 0H8H3H1.5V1.5V13.5C1.5 14.8807 2.61929 16 4 16H12C13.3807 16 14.5 14.8807 14.5 13.5ZM13 13.5V6.5H9.5H8V5V1.5H3V13.5C3 14.0523 3.44772 14.5 4 14.5H12C12.5523 14.5 13 14.0523 13 13.5ZM9.5 5V2.12132L12.3787 5H9.5ZM5.13 5.00062H4.505V6.25062H5.13H6H6.625V5.00062H6H5.13ZM4.505 8H5.13H11H11.625V9.25H11H5.13H4.505V8ZM5.13 11H4.505V12.25H5.13H11H11.625V11H11H5.13Z" fill="#666666"/>
</svg>
-------------------- END file-text.svg --------------------

-------------------- globe.svg (path: apps/web/public/globe.svg) --------------------
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_868_525)">
<path fill-rule="evenodd" clip-rule="evenodd" d="M10.268 14.0934C11.9051 13.4838 13.2303 12.2333 13.9384 10.6469C13.1192 10.7941 12.2138 10.9111 11.2469 10.9925C11.0336 12.2005 10.695 13.2621 10.268 14.0934ZM8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16ZM8.48347 14.4823C8.32384 14.494 8.16262 14.5 8 14.5C7.83738 14.5 7.67616 14.494 7.51654 14.4823C7.5132 14.4791 7.50984 14.4759 7.50647 14.4726C7.2415 14.2165 6.94578 13.7854 6.67032 13.1558C6.41594 12.5744 6.19979 11.8714 6.04101 11.0778C6.67605 11.1088 7.33104 11.125 8 11.125C8.66896 11.125 9.32395 11.1088 9.95899 11.0778C9.80021 11.8714 9.58406 12.5744 9.32968 13.1558C9.05422 13.7854 8.7585 14.2165 8.49353 14.4726C8.49016 14.4759 8.4868 14.4791 8.48347 14.4823ZM11.4187 9.72246C12.5137 9.62096 13.5116 9.47245 14.3724 9.28806C14.4561 8.87172 14.5 8.44099 14.5 8C14.5 7.55901 14.4561 7.12828 14.3724 6.71194C13.5116 6.52755 12.5137 6.37904 11.4187 6.27753C11.4719 6.83232 11.5 7.40867 11.5 8C11.5 8.59133 11.4719 9.16768 11.4187 9.72246ZM10.1525 6.18401C10.2157 6.75982 10.25 7.36805 10.25 8C10.25 8.63195 10.2157 9.24018 10.1525 9.81598C9.46123 9.85455 8.7409 9.875 8 9.875C7.25909 9.875 6.53877 9.85455 5.84749 9.81598C5.7843 9.24018 5.75 8.63195 5.75 8C5.75 7.36805 5.7843 6.75982 5.84749 6.18401C6.53877 6.14545 7.25909 6.125 8 6.125C8.74091 6.125 9.46123 6.14545 10.1525 6.18401ZM11.2469 5.00748C12.2138 5.08891 13.1191 5.20593 13.9384 5.35306C13.2303 3.7667 11.9051 2.51622 10.268 1.90662C10.695 2.73788 11.0336 3.79953 11.2469 5.00748ZM8.48347 1.51771C8.4868 1.52089 8.49016 1.52411 8.49353 1.52737C8.7585 1.78353 9.05422 2.21456 9.32968 2.84417C9.58406 3.42562 9.80021 4.12856 9.95899 4.92219C9.32395 4.89118 8.66896 4.875 8 4.875C7.33104 4.875 6.67605 4.89118 6.04101 4.92219C6.19978 4.12856 6.41594 3.42562 6.67032 2.84417C6.94578 2.21456 7.2415 1.78353 7.50647 1.52737C7.50984 1.52411 7.51319 1.52089 7.51653 1.51771C7.67615 1.50597 7.83738 1.5 8 1.5C8.16262 1.5 8.32384 1.50597 8.48347 1.51771ZM5.73202 1.90663C4.0949 2.51622 2.76975 3.7667 2.06159 5.35306C2.88085 5.20593 3.78617 5.08891 4.75309 5.00748C4.96639 3.79953 5.30497 2.73788 5.73202 1.90663ZM4.58133 6.27753C3.48633 6.37904 2.48837 6.52755 1.62761 6.71194C1.54392 7.12828 1.5 7.55901 1.5 8C1.5 8.44099 1.54392 8.87172 1.62761 9.28806C2.48837 9.47245 3.48633 9.62096 4.58133 9.72246C4.52807 9.16768 4.5 8.59133 4.5 8C4.5 7.40867 4.52807 6.83232 4.58133 6.27753ZM4.75309 10.9925C3.78617 10.9111 2.88085 10.7941 2.06159 10.6469C2.76975 12.2333 4.0949 13.4838 5.73202 14.0934C5.30497 13.2621 4.96639 12.2005 4.75309 10.9925Z" fill="#666666"/>
</g>
<defs>
<clipPath id="clip0_868_525">
<rect width="16" height="16" fill="white"/>
</clipPath>
</defs>
</svg>
-------------------- END globe.svg --------------------

-------------------- turborepo-dark.svg (path: apps/web/public/turborepo-dark.svg) --------------------
<svg width="473" height="76" viewBox="0 0 473 76" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M130.998 30.6565V22.3773H91.0977V30.6565H106.16V58.1875H115.935V30.6565H130.998Z" fill="black"/>
<path d="M153.542 58.7362C165.811 58.7362 172.544 52.5018 172.544 42.2275V22.3773H162.768V41.2799C162.768 47.0155 159.776 50.2574 153.542 50.2574C147.307 50.2574 144.315 47.0155 144.315 41.2799V22.3773H134.539V42.2275C134.539 52.5018 141.272 58.7362 153.542 58.7362Z" fill="black"/>
<path d="M187.508 46.3173H197.234L204.914 58.1875H216.136L207.458 45.2699C212.346 43.5243 215.338 39.634 215.338 34.3473C215.338 26.6665 209.603 22.3773 200.874 22.3773H177.732V58.1875H187.508V46.3173ZM187.508 38.5867V30.5568H200.376C203.817 30.5568 205.712 32.053 205.712 34.5967C205.712 36.9907 203.817 38.5867 200.376 38.5867H187.508Z" fill="black"/>
<path d="M219.887 58.1875H245.472C253.452 58.1875 258.041 54.397 258.041 48.0629C258.041 43.8235 255.348 40.9308 252.156 39.634C254.35 38.5867 257.043 36.0929 257.043 32.1528C257.043 25.8187 252.555 22.3773 244.625 22.3773H219.887V58.1875ZM229.263 36.3922V30.3074H243.627C246.32 30.3074 247.817 31.3548 247.817 33.3498C247.817 35.3448 246.32 36.3922 243.627 36.3922H229.263ZM229.263 43.7238H244.525C247.168 43.7238 248.615 45.0205 248.615 46.9657C248.615 48.9108 247.168 50.2075 244.525 50.2075H229.263V43.7238Z" fill="black"/>
<path d="M281.942 21.7788C269.423 21.7788 260.396 29.6092 260.396 40.2824C260.396 50.9557 269.423 58.786 281.942 58.786C294.461 58.786 303.438 50.9557 303.438 40.2824C303.438 29.6092 294.461 21.7788 281.942 21.7788ZM281.942 30.2575C288.525 30.2575 293.463 34.1478 293.463 40.2824C293.463 46.417 288.525 50.3073 281.942 50.3073C275.359 50.3073 270.421 46.417 270.421 40.2824C270.421 34.1478 275.359 30.2575 281.942 30.2575Z" fill="black"/>
<path d="M317.526 46.3173H327.251L334.932 58.1875H346.154L337.476 45.2699C342.364 43.5243 345.356 39.634 345.356 34.3473C345.356 26.6665 339.62 22.3773 330.892 22.3773H307.75V58.1875H317.526V46.3173ZM317.526 38.5867V30.5568H330.394C333.835 30.5568 335.73 32.053 335.73 34.5967C335.73 36.9907 333.835 38.5867 330.394 38.5867H317.526Z" fill="black"/>
<path d="M349.904 22.3773V58.1875H384.717V49.9083H359.48V44.0729H381.874V35.9932H359.48V30.6565H384.717V22.3773H349.904Z" fill="black"/>
<path d="M399.204 46.7662H412.221C420.95 46.7662 426.685 42.5767 426.685 34.5967C426.685 26.5668 420.95 22.3773 412.221 22.3773H389.428V58.1875H399.204V46.7662ZM399.204 38.6365V30.5568H411.673C415.164 30.5568 417.059 32.053 417.059 34.5967C417.059 37.0904 415.164 38.6365 411.673 38.6365H399.204Z" fill="black"/>
<path d="M450.948 21.7788C438.43 21.7788 429.402 29.6092 429.402 40.2824C429.402 50.9557 438.43 58.786 450.948 58.786C463.467 58.786 472.444 50.9557 472.444 40.2824C472.444 29.6092 463.467 21.7788 450.948 21.7788ZM450.948 30.2575C457.532 30.2575 462.469 34.1478 462.469 40.2824C462.469 46.417 457.532 50.3073 450.948 50.3073C444.365 50.3073 439.427 46.417 439.427 40.2824C439.427 34.1478 444.365 30.2575 450.948 30.2575Z" fill="black"/>
<path d="M38.5017 18.0956C27.2499 18.0956 18.0957 27.2498 18.0957 38.5016C18.0957 49.7534 27.2499 58.9076 38.5017 58.9076C49.7535 58.9076 58.9077 49.7534 58.9077 38.5016C58.9077 27.2498 49.7535 18.0956 38.5017 18.0956ZM38.5017 49.0618C32.6687 49.0618 27.9415 44.3346 27.9415 38.5016C27.9415 32.6686 32.6687 27.9414 38.5017 27.9414C44.3347 27.9414 49.0619 32.6686 49.0619 38.5016C49.0619 44.3346 44.3347 49.0618 38.5017 49.0618Z" fill="black"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M40.2115 14.744V7.125C56.7719 8.0104 69.9275 21.7208 69.9275 38.5016C69.9275 55.2824 56.7719 68.989 40.2115 69.8782V62.2592C52.5539 61.3776 62.3275 51.0644 62.3275 38.5016C62.3275 25.9388 52.5539 15.6256 40.2115 14.744ZM20.5048 54.0815C17.233 50.3043 15.124 45.4935 14.7478 40.2115H7.125C7.5202 47.6025 10.4766 54.3095 15.1088 59.4737L20.501 54.0815H20.5048ZM36.7916 69.8782V62.2592C31.5058 61.883 26.695 59.7778 22.9178 56.5022L17.5256 61.8944C22.6936 66.5304 29.4006 69.483 36.7878 69.8782H36.7916Z" fill="url(#paint0_linear_2028_278)"/>
<defs>
<linearGradient id="paint0_linear_2028_278" x1="41.443" y1="11.5372" x2="10.5567" y2="42.4236" gradientUnits="userSpaceOnUse">
<stop stop-color="#0096FF"/>
<stop offset="1" stop-color="#FF1E56"/>
</linearGradient>
</defs>
</svg>
-------------------- END turborepo-dark.svg --------------------

-------------------- postcss.config.mjs (path: apps/web/postcss.config.mjs) --------------------
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};
export default config;
-------------------- END postcss.config.mjs --------------------

-------------------- README.md (path: apps/web/README.md) --------------------
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load Inter, a custom Google Font.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
-------------------- END README.md --------------------

-------------------- utils.ts (path: apps/web/lib/utils.ts) --------------------
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
-------------------- END utils.ts --------------------

-------------------- Player.cs (path: apps/api/Models/Player.cs) --------------------
using System.Net.WebSockets;

namespace MyCsApi.Models
{
    public class Player
    {
        public string PlayerId { get; }
        public string Name { get; set; }
        public WebSocket Socket { get; }
        public string CurrentRoomCode { get; set; }

        public Player(string playerId, string name, WebSocket socket, string roomCode)
        {
            PlayerId = playerId;
            Name = name;
            Socket = socket;
            CurrentRoomCode = roomCode;
        }
    }
}
-------------------- END Player.cs --------------------

-------------------- Problem.cs (path: apps/api/Models/Problem.cs) --------------------
using System.Collections.Generic;
using System.Text.Json;
using System.Text.Json.Serialization;

namespace MyCsApi.Models
{
    public class ProblemTestCase
    {
        [JsonPropertyName("title")]
        public string? Title { get; set; }

        [JsonPropertyName("isTest")]
        public bool IsTest { get; set; }

        [JsonPropertyName("testIn")]
        public string? TestIn { get; set; }

        [JsonPropertyName("testOut")]
        public string? TestOut { get; set; }

        [JsonPropertyName("isValidator")]
        public bool IsValidator { get; set; }
    }

    public class ProblemData
    {
        [JsonPropertyName("statement")]
        public string? Statement { get; set; }

        [JsonPropertyName("testCases")]
        public List<ProblemTestCase> TestCases { get; set; } = new();

        [JsonPropertyName("constraints")]
        public string? Constraints { get; set; }

        [JsonPropertyName("inputDescription")]
        public string? InputDescription { get; set; }

        [JsonPropertyName("outputDescription")]
        public string? OutputDescription { get; set; }
    }

    public class ProblemLastVersion
    {
        [JsonPropertyName("data")]
        public ProblemData? Data { get; set; }
    }

    public class Problem
    {
        [JsonPropertyName("title")]
        public string? Title { get; set; }

        [JsonPropertyName("lastVersion")]
        public ProblemLastVersion? LastVersion { get; set; }
    }
}
-------------------- END Problem.cs --------------------

-------------------- GameRoom.cs (path: apps/api/Models/GameRoom.cs) --------------------
using System.Collections.Generic;
using System.Linq;

namespace MyCsApi.Models
{
    public class GameRoom
    {
        public string RoomCode { get; }
        public string GameId { get; }
        public string HostPlayerId { get; private set; }
        public string GameState { get; set; } = "Lobby";
        private readonly List<Player> _players = new();
        public IReadOnlyCollection<Player> Players => _players.AsReadOnly();

        public GameRoom(string roomCode, string     gameId, string hostPlayerId)
        {
            RoomCode = roomCode;
            GameId = gameId;
            HostPlayerId = hostPlayerId;
        }

        public void AddPlayer(Player player)
        {
            if (!_players.Any(p => p.PlayerId == player.PlayerId))
            {
                _players.Add(player);
            }
        }

        public void RemovePlayer(Player player)
        {
            _players.RemoveAll(p => p.PlayerId == player.PlayerId);
        }
        public void RemovePlayer(string playerId)
        {
            _players.RemoveAll(p => p.PlayerId == playerId);
        }
    }
}
-------------------- END GameRoom.cs --------------------

-------------------- WebSocketMessages.cs (path: apps/api/Models/WebSocketMessages.cs) --------------------
using System.Collections.Generic;
using System.Text.Json.Serialization;

namespace MyCsApi.Models
{
    public record BaseWebSocketMessage(string Type);

    public record CreateRoomClientPayload(string PlayerName);
    public record CreateRoomClientMessage(string Type, CreateRoomClientPayload Payload) : BaseWebSocketMessage(Type);

    public record JoinRoomClientPayload(string PlayerName, string RoomCode);
    public record JoinRoomClientMessage(string Type, JoinRoomClientPayload Payload) : BaseWebSocketMessage(Type);

    public record StartGameClientPayload();
    public record StartGameClientMessage(string Type, StartGameClientPayload Payload) : BaseWebSocketMessage(Type)
    {
        public StartGameClientMessage() : this("startGame", new StartGameClientPayload()) { }
    }


    public record PlayerInfo(string Id, string Name);

    public record RoomCreatedServerPayload(string RoomCode, string PlayerId, string PlayerName, string GameId, string HostPlayerId);
    public record RoomCreatedServerMessage(string Type, RoomCreatedServerPayload Payload) : BaseWebSocketMessage(Type)
    {
        public RoomCreatedServerMessage(string roomCode, string playerId, string playerName, string gameId, string hostPlayerId)
            : this("roomCreated", new RoomCreatedServerPayload(roomCode, playerId, playerName, gameId, hostPlayerId)) { }
    }

    public record JoinSuccessServerPayload(string RoomCode, string PlayerId, string PlayerName, string GameId, List<PlayerInfo> PlayersInLobby, string HostPlayerId);
    public record JoinSuccessServerMessage(string Type, JoinSuccessServerPayload Payload) : BaseWebSocketMessage(Type)
    {
        public JoinSuccessServerMessage(string roomCode, string playerId, string playerName, string gameId, List<PlayerInfo> playersInLobby, string hostPlayerId)
            : this("joinSuccess", new JoinSuccessServerPayload(roomCode, playerId, playerName, gameId, playersInLobby, hostPlayerId)) { }
    }

    public record JoinFailedServerPayload(string Reason);
    public record JoinFailedServerMessage(string Type, JoinFailedServerPayload Payload) : BaseWebSocketMessage(Type)
    {
        public JoinFailedServerMessage(string reason) : this("joinFailed", new JoinFailedServerPayload(reason)) { }
    }

    public record PlayerJoinedLobbyServerPayload(string PlayerId, string PlayerName);
    public record PlayerJoinedLobbyServerMessage(string Type, PlayerJoinedLobbyServerPayload Payload) : BaseWebSocketMessage(Type)
    {
        public PlayerJoinedLobbyServerMessage(string playerId, string playerName)
            : this("playerJoinedLobby", new PlayerJoinedLobbyServerPayload(playerId, playerName)) { }
    }

    public record PlayerLeftLobbyServerPayload(string PlayerId, string PlayerName);
    public record PlayerLeftLobbyServerMessage(string Type, PlayerLeftLobbyServerPayload Payload) : BaseWebSocketMessage(Type)
    {
        public PlayerLeftLobbyServerMessage(string playerId, string playerName)
           : this("playerLeftLobby", new PlayerLeftLobbyServerPayload(playerId, playerName)) { }
    }

    public record GameStartedServerPayload(List<PlayerInfo> PlayersInGame);
    public record GameStartedServerMessage(string Type, GameStartedServerPayload Payload) : BaseWebSocketMessage(Type)
    {
        public GameStartedServerMessage(List<PlayerInfo> playersInGame)
            : this("gameStarted", new GameStartedServerPayload(playersInGame)) { }
    }


    public record UseCardPayload(string CardName, string PlayerId, string TargetPlayerId);

    public record UseCardMessage(string Type, UseCardPayload Payload) : BaseWebSocketMessage(Type)
    {
        public UseCardMessage(string cardName, string playerId, string targetPlayerId)
            : this("useCard", new UseCardPayload(cardName, playerId, targetPlayerId)) { }
    }

    public record NewProblemPayload(string ProblemName, string ProblemInfo);

    public record NewProblemMessage(string Type, NewProblemPayload Payload) : BaseWebSocketMessage(Type)
    {
        public NewProblemMessage(string problemName, string problemInfo)
            : this("newProblem", new NewProblemPayload(problemName, problemInfo)) { }
    }

    public record PlayerStateUpdatePayload(string PlayerId, int Hp, string CardName);
    public record PlayerStateUpdateMessage(string Type, PlayerStateUpdatePayload Payload) : BaseWebSocketMessage(Type)
    {
        public PlayerStateUpdateMessage(string playerId, int hp, string cardName)
            : this("playerStateUpdate", new PlayerStateUpdatePayload(playerId, hp, cardName)) { }
    }

    public record PlayerEliminatedPayload(string PlayerId, string PlayerName, string Reason);
    public record PlayerEliminatedMessage(string Type, PlayerEliminatedPayload Payload) : BaseWebSocketMessage(Type)
    {
        public PlayerEliminatedMessage(string playerId, string playerName, string reason)
            : this("playerEliminated", new PlayerEliminatedPayload(playerId, playerName, reason)) { }
    }

    public record GameOverPayload(string PlayerId, string PlayerName);
    public record GameOverMessage(string Type, GameOverPayload Payload) : BaseWebSocketMessage(Type)
    {
        public GameOverMessage(string playerId, string playerName)
            : this("gameOver", new GameOverPayload(playerId, playerName)) { }
    }

    public record StartGamePayload();

    public record StartGameMessage(string Type, StartGamePayload Payload) : BaseWebSocketMessage(Type)
    {
        public StartGameMessage() :
            this("startGame", new StartGamePayload())
        { }
    }

    public record PlayerSolvedPayload(string PlayerName, string PlayerId);

    public record PlayerSolvedMessage(string Type, PlayerSolvedPayload Payload) : BaseWebSocketMessage(Type)
    {
        public PlayerSolvedMessage(string playerName, string playerId)
            : this("playerSolved", new PlayerSolvedPayload(playerName, playerId)) { }
    }

    public record ProblemDetailsPayload(string Title, string Statement, string InputDescription, string OutputDescription, string? Constraints, List<ProblemTestCase> TestCases);

    public record NewProblemServerMessage(string Type, ProblemDetailsPayload Payload) : BaseWebSocketMessage(Type)
    {
        public NewProblemServerMessage(string title, string statement, string inputDesc, string outputDesc, string constraints, List<ProblemTestCase> testCases)
            : this("newProblem", new ProblemDetailsPayload(title, statement, inputDesc, outputDesc, constraints ?? string.Empty, testCases)) { }
    }

    public record SyntaxScramblePayload(string PlayerId, string TargetPlayerId, string CardName);

    public record SyntaxScrambleMessage(string Type, SyntaxScramblePayload Payload) : BaseWebSocketMessage(Type)
    {
        public SyntaxScrambleMessage(string playerId, string targetPlayerId, string cardName)
            : this("SyntaxScramble", new SyntaxScramblePayload(playerId, targetPlayerId, cardName)) { }
    }

    public record DamagePayload(string PlayerId, string TargetPlayerId, int Damage, string CardName);

    public record DamageMessage(string Type, DamagePayload Payload) : BaseWebSocketMessage(Type)
    {
        public DamageMessage(string playerId, string targetPlayerId, int damage, string cardName)
            : this("Damage", new DamagePayload(playerId, targetPlayerId, damage, cardName)) { }
    }

    public record DefendPayload(string PlayerId, int Defend, string CardName);

    public record DefendMessage(string Type, DefendPayload Payload) : BaseWebSocketMessage(Type)
    {
        public DefendMessage(string playerId, int defense, string cardName)
            : this("Defend", new DefendPayload(playerId, defense, cardName)) { }
    }

    public record BlockPayload(string PlayerId, string CardName);

    public record BlockMessage(string Type, BlockPayload Payload) : BaseWebSocketMessage(Type)
    {
        public BlockMessage(string playerId, string cardName)
            : this("Block", new BlockPayload(playerId, cardName)) { }
    }

    public record HealPayload(string PlayerId, int Hp, string CardName);

    public record HealMessage(string Type, HealPayload Payload) : BaseWebSocketMessage(Type)
    {
        public HealMessage(string playerId, int hp, string cardName)
            : this("Heal", new HealPayload(playerId, hp, cardName)) { }
    }

    public record VibeCodePayload(string PlayerId, string TargetPlayerId, string CardName);

    public record VibeCodeMessage(string Type, VibeCodePayload Payload) : BaseWebSocketMessage(Type)
    {
        public VibeCodeMessage(string playerId, string targetPlayerId, string cardName)
            : this("VibeCode", new VibeCodePayload(playerId, targetPlayerId, cardName)) { }
    }

    public record CompilerAttackPayload(string PlayerId, string TargetPlayerId, string CardName);

    public record CompilerAttackMessage(string Type, CompilerAttackPayload Payload) : BaseWebSocketMessage(Type)
    {
        public CompilerAttackMessage(string playerId, string targetPlayerId, string cardName)
            : this("compilerAttack", new CompilerAttackPayload(playerId, targetPlayerId, cardName)) { }
    }

    public record LeakPayload(string PlayerId, string CardName);

    public record LeakMessage(string Type, LeakPayload Payload) : BaseWebSocketMessage(Type)
    {
        public LeakMessage(string playerId, string cardName)
            : this("leak", new LeakPayload(playerId, cardName)) { }
    }
}
-------------------- END WebSocketMessages.cs --------------------

-------------------- Judge0Settings.cs (path: apps/api/Models/Judge0Settings.cs) --------------------
namespace MyCsApi.Models
{
    public class Judge0Settings
    {
        public string ApiUrl { get; set; } = string.Empty;
        public int DefaultPythonLanguageId { get; set; } = 71;
        public string? ApiKey { get; set; }
        public string? ApiHost { get; set; }
    }
}
-------------------- END Judge0Settings.cs --------------------

-------------------- package.json (path: apps/api/package.json) --------------------
{
  "name": "api",
  "module": "index.ts",
  "type": "module",
  "private": true,
  "scripts": {
    "clean": "dotnet clean",
    "build": "dotnet build",
    "dev": "dotnet watch run",
    "start": "dotnet run --launch-profile Production"
  },
  "devDependencies": {
    "@types/bun": "latest"
  },
  "peerDependencies": {
    "typescript": "^5"
  }
}
-------------------- END package.json --------------------

-------------------- GameController.cs (path: apps/api/Controllers/GameController.cs) --------------------
using Microsoft.AspNetCore.Mvc;

namespace MyCsApi.Controllers;

[ApiController]
[Route("[controller]")]
public class GameController : ControllerBase
{
    [HttpGet("health")]
    public IActionResult HealthCheck()
    {
        return Ok(new { status = "API is healthy" });
    }
}
-------------------- END GameController.cs --------------------

-------------------- JudgeController.cs (path: apps/api/Controllers/JudgeController.cs) --------------------
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Logging;
using Microsoft.Extensions.Options;
using MyCsApi.Models;
using MyCsApi.Services;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace MyCsApi.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class JudgeController : ControllerBase
    {
        private readonly IJudgeService _judgeService;
        private readonly Judge0Settings _judge0Settings;
        private readonly ILogger<JudgeController> _logger;

        public JudgeController(IJudgeService judgeService, IOptions<Judge0Settings> judge0Settings, ILogger<JudgeController> logger)
        {
            _judgeService = judgeService;
            _judge0Settings = judge0Settings.Value;
            _logger = logger;
        }

        [HttpPost("submit")]
        public async Task<IActionResult> SubmitCode([FromBody] CodeSubmissionRequest request)
        {
            if (request == null || string.IsNullOrWhiteSpace(request.SourceCode) || request.TestCases == null)
            {
                return BadRequest(new { message = "Invalid submission request." });
            }

            _logger.LogInformation($"Received code submission. Language ID: {request.LanguageId}. Test cases: {request.TestCases.Count}");

            var results = new List<TestCaseExecutionResult>();
            bool allPassed = true;
            string? overallCompilationOutput = null;
            string? overallErrorOutput = null;


            foreach (var testCase in request.TestCases)
            {
                _logger.LogInformation($"Executing test case: {testCase.Title}");
                var judgeResult = await _judgeService.SubmitCodeAsync(
                    request.SourceCode,
                    request.LanguageId > 0 ? request.LanguageId : _judge0Settings.DefaultPythonLanguageId,
                    testCase.Stdin,
                    testCase.ExpectedOutput
                );

                var caseResult = new TestCaseExecutionResult
                {
                    Title = testCase.Title,
                    ExpectedOutput = testCase.ExpectedOutput,
                    ActualOutput = judgeResult?.Stdout?.TrimEnd('\n', '\r'),
                    Status = judgeResult?.Status?.Description ?? "Unknown Error",
                    Judge0StatusId = judgeResult?.Status?.Id ?? 0,
                    ErrorMessage = judgeResult?.Stderr ?? judgeResult?.CompileOutput ?? judgeResult?.ErrorDetails,
                    Time = judgeResult?.Time,
                    Memory = judgeResult?.Memory
                };

                if (judgeResult?.CompileOutput != null && overallCompilationOutput == null)
                {
                    overallCompilationOutput = judgeResult.CompileOutput;
                }
                if (judgeResult?.Stderr != null && string.IsNullOrEmpty(caseResult.ActualOutput)) // Prioritize stderr if stdout is empty
                {
                    overallErrorOutput = string.IsNullOrEmpty(overallErrorOutput) ? judgeResult.Stderr : $"{overallErrorOutput}\n{judgeResult.Stderr}";
                }


                if (judgeResult != null && judgeResult.Status != null)
                {
                    if (judgeResult.Status.Id == 3) // Accepted
                    {
                        var actual = caseResult.ActualOutput ?? "";
                        var expected = testCase.ExpectedOutput?.TrimEnd('\n', '\r') ?? "";
                        caseResult.Passed = actual.Equals(expected);
                    }
                    else
                    {
                        caseResult.Passed = false;
                    }
                }
                else
                {
                    caseResult.Passed = false;
                    caseResult.Status = judgeResult?.ErrorDetails ?? "Failed to get result from Judge0";
                }

                if (!caseResult.Passed) allPassed = false;
                results.Add(caseResult);

                if (judgeResult?.Status?.Id == 6)
                {
                    overallCompilationOutput = judgeResult.CompileOutput ?? "Compilation failed.";
                    allPassed = false;
                    break;
                }
                if (judgeResult?.Status?.Id > 6 && judgeResult?.Status?.Id <= 13)
                {
                    overallErrorOutput = string.IsNullOrEmpty(overallErrorOutput) ? (judgeResult.Stderr ?? judgeResult.Status.Description) : $"{overallErrorOutput}\n{judgeResult.Stderr ?? judgeResult.Status.Description}";
                    allPassed = false;
                }
            }

            string overallStatus;
            if (overallCompilationOutput != null) overallStatus = "Compilation Error";
            else if (overallErrorOutput != null && !results.Any(r => r.Passed)) overallStatus = "Runtime Error";
            else if (allPassed) overallStatus = "All tests passed!";
            else if (results.Any(r => r.Passed)) overallStatus = "Some tests failed";
            else overallStatus = "All tests failed";


            return Ok(new CodeSubmissionResult
            {
                Results = results,
                OverallStatus = overallStatus,
                CompilationOutput = overallCompilationOutput,
                ErrorOutput = overallErrorOutput
            });
        }
    }

    public class CodeSubmissionRequest
    {
        public string SourceCode { get; set; } = string.Empty;
        public int LanguageId { get; set; }
        public List<ApiProblemTestCase> TestCases { get; set; } = new();
    }

    public class ApiProblemTestCase
    {
        public string Title { get; set; } = string.Empty;
        public string? Stdin { get; set; }
        public string? ExpectedOutput { get; set; }
    }

    public class CodeSubmissionResult
    {
        public List<TestCaseExecutionResult> Results { get; set; } = new();
        public string OverallStatus { get; set; } = string.Empty;
        public string? CompilationOutput { get; set; }
        public string? ErrorOutput { get; set; }
    }

    public class TestCaseExecutionResult
    {
        public string Title { get; set; } = string.Empty;
        public bool Passed { get; set; }
        public string? ActualOutput { get; set; }
        public string? ExpectedOutput { get; set; }
        public string Status { get; set; } = string.Empty;
        public int Judge0StatusId { get; set; }
        public string? ErrorMessage { get; set; }
        public string? Time { get; set; }
        public int? Memory { get; set; }
    }
}
-------------------- END JudgeController.cs --------------------

-------------------- MyCsApi.csproj (path: apps/api/MyCsApi.csproj) --------------------
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.AspNetCore.OpenApi" Version="9.0.4" />
  </ItemGroup>

  <ItemGroup>
    <Content Update="problems.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
  </ItemGroup>

</Project>
-------------------- END MyCsApi.csproj --------------------

-------------------- .gitignore (path: apps/api/.gitignore) --------------------
# dependencies (bun install)
node_modules

# output
out
dist
*.tgz

# code coverage
coverage
*.lcov

# logs
logs
_.log
report.[0-9]_.[0-9]_.[0-9]_.[0-9]_.json

# dotenv environment variable files
.env
.env.development.local
.env.test.local
.env.production.local
.env.local

# caches
.eslintcache
.cache
*.tsbuildinfo

# IntelliJ based IDEs
.idea

# Finder (MacOS) folder config
.DS_Store

*.AssemblyInfo.cs
*.cache
-------------------- END .gitignore --------------------

-------------------- Item.cs (path: apps/api/Item.cs) --------------------
namespace MyCsApi;

public class Item
{
    
}
-------------------- END Item.cs --------------------

-------------------- tsconfig.json (path: apps/api/tsconfig.json) --------------------
{
  "compilerOptions": {
    // Environment setup & latest features
    "lib": ["ESNext"],
    "target": "ESNext",
    "module": "ESNext",
    "moduleDetection": "force",
    "jsx": "react-jsx",
    "allowJs": true,

    // Bundler mode
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "noEmit": true,

    // Best practices
    "strict": true,
    "skipLibCheck": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,

    // Some stricter flags (disabled by default)
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noPropertyAccessFromIndexSignature": false
  }
}
-------------------- END tsconfig.json --------------------

-------------------- MyCsApi.http (path: apps/api/MyCsApi.http) --------------------
@MyCsApi_HostAddress = http://localhost:5217

GET {{MyCsApi_HostAddress}}/weatherforecast/
Accept: application/json

###
-------------------- END MyCsApi.http --------------------

-------------------- launchSettings.json (path: apps/api/Properties/launchSettings.json) --------------------
{
  "$schema": "https://json.schemastore.org/launchsettings.json",
  "profiles": {
    "http": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": false,
      "applicationUrl": "http://localhost:5217",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    },
    "https": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": false,
      "applicationUrl": "https://localhost:7007;http://localhost:5217",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}
-------------------- END launchSettings.json --------------------

-------------------- Program.cs (path: apps/api/Program.cs) --------------------
using System.Net.WebSockets;
using System.Text;
using System.Text.Json;
using Microsoft.AspNetCore.Builder;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using MyCsApi.Services;
using MyCsApi.WebSockets;
using Microsoft.Extensions.Options;
using MyCsApi.Models;

var builder = WebApplication.CreateBuilder(args);

var myAllowAllOriginsPolicy = "_myAllowAllOriginsPolicy";

builder.Services.AddCors(options =>
{
    options.AddPolicy(name: myAllowAllOriginsPolicy, policy =>
    {
        policy.WithOrigins("http://localhost:3000")
              .AllowAnyHeader()
              .AllowAnyMethod()
              .AllowCredentials();
    });
});

builder.Services.Configure<Judge0Settings>(builder.Configuration.GetSection("Judge0"));

builder.Services.AddControllers();
builder.Services.AddEndpointsApiExplorer();

builder.Services.AddSingleton<IRoomManager, RoomManager>();
builder.Services.AddSingleton<ICardManager, CardManager>();
builder.Services.AddSingleton<IProblemService, ProblemService>();
builder.Services.AddSingleton<WebSocketMessageHandler>();

builder.Services.AddHttpClient<IJudgeService, JudgeService>();


var app = builder.Build();

if (app.Environment.IsDevelopment())
{
    // app.MapOpenApi(); 
}

app.UseHttpsRedirection();
app.UseCors(myAllowAllOriginsPolicy);
app.UseAuthorization();
app.MapControllers();

app.UseWebSockets(new WebSocketOptions
{
    KeepAliveInterval = TimeSpan.FromSeconds(120),
});

app.Map("/ws", async context =>
{
    if (context.WebSockets.IsWebSocketRequest)
    {
        using var webSocket = await context.WebSockets.AcceptWebSocketAsync();
        var handler = app.Services.GetRequiredService<WebSocketMessageHandler>();
        await handler.HandleWebSocketAsync(webSocket);
    }
    else
    {
        context.Response.StatusCode = StatusCodes.Status400BadRequest;
    }
});

app.Run();
-------------------- END Program.cs --------------------

-------------------- appsettings.json (path: apps/api/appsettings.json) --------------------
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "Judge0": {
    "ApiUrl": "http://20.84.52.40:2358",
    "DefaultPythonLanguageId": 71,
    "ApiKey": null,
    "ApiHost": null
  },
  "AllowedHosts": "*"
}
-------------------- END appsettings.json --------------------

-------------------- appsettings.Development.json (path: apps/api/appsettings.Development.json) --------------------
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  }
}
-------------------- END appsettings.Development.json --------------------

-------------------- index.ts (path: apps/api/index.ts) --------------------
// console.log("Hello via Bun!");
-------------------- END index.ts --------------------

-------------------- CardManager.cs (path: apps/api/Services/CardManager.cs) --------------------
using System.Collections.Concurrent;
using System.Net.WebSockets;
using System.Text;
using System.Text.Json;
using MyCsApi.Models;

namespace MyCsApi.Services;

public interface ICardManager
{
    public Task UseCardAsync(WebSocket webSocket, string playerId, string cardName, string targetPlayerId);
}

public class CardManager : ICardManager
{
    private readonly ILogger<CardManager> _logger;
    private readonly ConcurrentDictionary<string, Player> _players;

    public CardManager(ILogger<CardManager> logger, IRoomManager roomManager)
    {
        _logger = logger;
        _players = roomManager.GetPlayers();
    }
    
    private static readonly JsonSerializerOptions _jsonSerializerOptions = new()
    {
        PropertyNamingPolicy = JsonNamingPolicy.CamelCase
    };

    public async Task UseCardAsync(WebSocket webSocket, string playerId, string cardName, string targetPlayerId)
    {
        switch (cardName)
        {
            case "Attack":
                var stateMessage = new DamageMessage(playerId, targetPlayerId, 20, cardName);
                await SendMessageAsync(webSocket, stateMessage);
                break;
            case "SyntaxScramble":
                var scrambleMessage = new SyntaxScrambleMessage(playerId, targetPlayerId, cardName);
                await SendMessageAsync(webSocket, scrambleMessage);
                break;
            case "Casino":
                var casinoMessage = new DamageMessage(playerId, targetPlayerId, Random.Shared.Next(30), cardName);
                await SendMessageAsync(webSocket, casinoMessage);
                break;
            case "CompilerAttack":
                var compilerMessage = new CompilerAttackMessage(playerId, targetPlayerId, cardName);
                await SendMessageAsync(webSocket, compilerMessage);
                break;
            case "Leak":
                var leakMessage = new LeakMessage(playerId, targetPlayerId);
                await SendMessageAsync(webSocket, leakMessage);
                break;
            case "Defend":
                var defendMessage = new DefendMessage(playerId, 15, cardName);
                await SendMessageAsync(webSocket, defendMessage);
                break;
            case "Block":
                var blockMessage = new BlockMessage(playerId, cardName);
                await SendMessageAsync(webSocket, blockMessage);
                break;
            case "Heal":
                var healMessage = new HealMessage(playerId, 15, cardName);
                await SendMessageAsync(webSocket, healMessage);
                break;
            case "VibeCode":
                var vibeCodeMessage = new VibeCodeMessage(playerId, targetPlayerId, cardName);
                await SendMessageAsync(webSocket, vibeCodeMessage);
                break;
            
        }
        
    }

    private async Task SendMessageAsync(WebSocket webSocket, object message)
    {
        if (webSocket.State == WebSocketState.Open)
        {
            var messageJson = JsonSerializer.Serialize(message, _jsonSerializerOptions);
            var bytes = Encoding.UTF8.GetBytes(messageJson);
            await webSocket.SendAsync(new ArraySegment<byte>(bytes), WebSocketMessageType.Text, true, CancellationToken.None);
            _logger.LogDebug($"Sent message: {messageJson}");
        }
    }
}
-------------------- END CardManager.cs --------------------

-------------------- ProblemService.cs (path: apps/api/Services/ProblemService.cs) --------------------
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text.Json;
using System.Threading.Tasks;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.Logging;
using MyCsApi.Models;

namespace MyCsApi.Services
{
    public interface IProblemService
    {
        Problem? GetRandomProblem();
    }

    public class ProblemService : IProblemService
    {
        private List<Problem> _problems = new();
        private readonly Random _random = new();
        private readonly ILogger<ProblemService> _logger;

        public ProblemService(ILogger<ProblemService> logger, IHostEnvironment env)
        {
            _logger = logger;
            var filePath = Path.Combine(env.ContentRootPath, "problems.json");

            try
            {
                if (File.Exists(filePath))
                {
                    var jsonString = File.ReadAllText(filePath);
                    var options = new JsonSerializerOptions
                    {
                        PropertyNameCaseInsensitive = true,
                    };
                    _problems = JsonSerializer.Deserialize<List<Problem>>(jsonString, options) ?? new List<Problem>();
                    _logger.LogInformation($"Successfully loaded {_problems.Count} problems from {filePath}.");
                }
                else
                {
                    _logger.LogWarning($"Problem file not found at {filePath}. No problem will be available.");
                    _problems = new List<Problem>();
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error loading or deserializing problems from {filePath}.");
                _problems = new List<Problem>();
            }
        }

        public Problem? GetRandomProblem()
        {
            if (_problems == null || !_problems.Any())
            {
                _logger.LogWarning("Attempted to get a random problem, but no problems are loaded.");
                return null;
            }
            return _problems[_random.Next(_problems.Count)];
        }
    }
}
-------------------- END ProblemService.cs --------------------

-------------------- RoomManager.cs (path: apps/api/Services/RoomManager.cs) --------------------
using System;
using System.Collections.Concurrent;
using System.Collections.Generic;
using System.Linq;
using System.Net.WebSockets;
using System.Text;
using System.Text.Json;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.Extensions.Logging;
using MyCsApi.Models;

namespace MyCsApi.Services
{
    public interface IRoomManager
    {
        public Task CreateRoomAsync(WebSocket webSocket, string playerId, string playerName);
        public Task JoinRoomAsync(WebSocket webSocket, string playerId, string playerName, string roomCode);
        public Task StartGameAsync(string playerId);
        public Task PlayerDisconnectedAsync(string playerId, WebSocket webSocket);
        public ConcurrentDictionary<string, Player> GetPlayers();
    }
    public class RoomManager : IRoomManager
    {
        private readonly ConcurrentDictionary<string, GameRoom> _rooms = new();
        private readonly ConcurrentDictionary<string, Player> _players = new();
        private readonly ILogger<RoomManager> _logger;
        private readonly IProblemService _problemService;
        private static readonly JsonSerializerOptions _jsonSerializerOptions = new()
        {
            PropertyNamingPolicy = JsonNamingPolicy.CamelCase
        };

        public RoomManager(ILogger<RoomManager> logger, IProblemService problemService)
        {
            _logger = logger;
            _problemService = problemService;
        }

        public ConcurrentDictionary<string, Player> GetPlayers()
        {
            return _players;
        }

        private string GenerateRoomCode()
        {
            var chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            var random = new Random();
            return new string(Enumerable.Repeat(chars, 5)
              .Select(s => s[random.Next(s.Length)]).ToArray());
        }

        public async Task CreateRoomAsync(WebSocket webSocket, string playerId, string playerName)
        {
            var roomCode = GenerateRoomCode();
            while (_rooms.ContainsKey(roomCode))
            {
                roomCode = GenerateRoomCode();
            }

            var gameId = Guid.NewGuid().ToString();
            var newPlayer = new Player(playerId, playerName, webSocket, roomCode);
            var room = new GameRoom(roomCode, gameId, playerId);
            room.AddPlayer(newPlayer);

            if (_rooms.TryAdd(roomCode, room) && _players.TryAdd(playerId, newPlayer))
            {
                _logger.LogInformation($"Room {roomCode} created by player {playerName} ({playerId}). GameID: {gameId}");
                var response = new RoomCreatedServerMessage(roomCode, playerId, playerName, gameId, playerId);
                await SendMessageAsync(webSocket, response);
            }
            else
            {
                _logger.LogError($"Failed to add room {roomCode} or player {playerId}.");
                await SendMessageAsync(webSocket, new JoinFailedServerMessage("Failed to create room. Please try again."));
            }
        }

        public async Task JoinRoomAsync(WebSocket webSocket, string playerId, string playerName, string roomCode)
        {
            if (!_rooms.TryGetValue(roomCode, out var room))
            {
                await SendMessageAsync(webSocket, new JoinFailedServerMessage("Room not found."));
                return;
            }

            if (room.Players.Count >= 10)
            {
                await SendMessageAsync(webSocket, new JoinFailedServerMessage("Room is full."));
                return;
            }

            if (room.Players.Any(p => p.PlayerId == playerId || p.Name.Equals(playerName, StringComparison.OrdinalIgnoreCase)))
            {
                await SendMessageAsync(webSocket, new JoinFailedServerMessage("Player ID or name already in room."));
                return;
            }

            var newPlayer = new Player(playerId, playerName, webSocket, roomCode);
            room.AddPlayer(newPlayer);

            if (!_players.TryAdd(playerId, newPlayer))
            {
                room.RemovePlayer(newPlayer);
                await SendMessageAsync(webSocket, new JoinFailedServerMessage("Failed to add player. Please try again."));
                _logger.LogError($"Failed to add player {playerId} to global player list for room {roomCode}.");
                return;
            }

            _logger.LogInformation($"Player {playerName} ({playerId}) joined room {roomCode}. GameID: {room.GameId}");

            var joinSuccessResponse = new JoinSuccessServerMessage(
                room.RoomCode,
                playerId,
                playerName,
                room.GameId,
                room.Players.Where(p => p.PlayerId != playerId).Select(p => new PlayerInfo(p.PlayerId, p.Name)).ToList(),
                room.HostPlayerId
            );
            await SendMessageAsync(webSocket, joinSuccessResponse);

            var playerJoinedLobbyMessage = new PlayerJoinedLobbyServerMessage(playerId, playerName);
            await BroadcastMessageToRoomAsync(roomCode, playerJoinedLobbyMessage, playerId);
        }

        public async Task StartGameAsync(string playerId)
        {
            if (!_players.TryGetValue(playerId, out var requestingPlayer))
            {
                _logger.LogWarning($"StartGameAsync: Player {playerId} not found.");
                return;
            }

            if (!_rooms.TryGetValue(requestingPlayer.CurrentRoomCode, out var room))
            {
                _logger.LogWarning($"StartGameAsync: Room {requestingPlayer.CurrentRoomCode} not found for player {playerId}.");
                await SendMessageAsync(requestingPlayer.Socket, new JoinFailedServerMessage("Room not found.")); // Or a more specific error
                return;
            }

            if (room.HostPlayerId != playerId)
            {
                _logger.LogWarning($"Player {playerId} attempted to start game in room {room.RoomCode} but is not the host.");
                await SendMessageAsync(requestingPlayer.Socket, new JoinFailedServerMessage("Only the host can start the game."));
                return;
            }

            if (room.GameState != "Lobby")
            {
                _logger.LogInformation($"Game in room {room.RoomCode} has already started or finished.");
                await SendMessageAsync(requestingPlayer.Socket, new JoinFailedServerMessage($"Game is already {room.GameState}."));
                return;
            }

            room.GameState = "InProgress";
            _logger.LogInformation($"Game started in room {room.RoomCode} by host {playerId}");

            var playersInGame = room.Players.Select(p => new PlayerInfo(p.PlayerId, p.Name)).ToList();
            var gameStartedMessage = new GameStartedServerMessage(playersInGame);
            await BroadcastMessageToRoomAsync(room.RoomCode, gameStartedMessage);

            var problem = _problemService.GetRandomProblem();
            if (problem != null && problem.LastVersion?.Data != null)
            {
                var problemData = problem.LastVersion.Data;
                var testCasesForMessage = problemData.TestCases ?? new List<ProblemTestCase>();
                var newProblemMessage = new NewProblemServerMessage(
                    problem.Title ?? "Untitled Problem", // Provide default if null
                    problemData.Statement ?? "No statement provided.", // Provide default if null
                    problemData.InputDescription ?? "No input description provided.", // Provide default if null
                    problemData.OutputDescription ?? "No output description provided.", // Provide default if null
                    problemData.Constraints, // This is handled by the constructor (constraints ?? string.Empty)
                    testCasesForMessage
                );
                await BroadcastMessageToRoomAsync(room.RoomCode, newProblemMessage);
                _logger.LogInformation($"Sent problem '{problem.Title ?? "Untitled Problem"}' to room {room.RoomCode}");
            }
            else
            {
                _logger.LogWarning($"Could not retrieve a problem for room {room.RoomCode}. No problem will be sent.");
            }
        }

        public async Task PlayerDisconnectedAsync(string playerId, WebSocket webSocket)
        {
            if (_players.TryRemove(playerId, out var player))
            {
                if (_rooms.TryGetValue(player.CurrentRoomCode, out var room))
                {
                    room.RemovePlayer(player);
                    _logger.LogInformation($"Player {player.Name} ({playerId}) disconnected from room {player.CurrentRoomCode}.");

                    var playerLeftMessage = new PlayerLeftLobbyServerMessage(playerId, player.Name);
                    await BroadcastMessageToRoomAsync(player.CurrentRoomCode, playerLeftMessage);

                    if (room.Players.Count == 0)
                    {
                        _rooms.TryRemove(room.RoomCode, out _);
                        _logger.LogInformation($"Room {room.RoomCode} is now empty and has been removed.");
                    }
                }
            }
        }


        private async Task SendMessageAsync(WebSocket webSocket, object message)
        {
            if (webSocket.State == WebSocketState.Open)
            {
                var messageJson = JsonSerializer.Serialize(message, _jsonSerializerOptions);
                var bytes = Encoding.UTF8.GetBytes(messageJson);
                await webSocket.SendAsync(new ArraySegment<byte>(bytes), WebSocketMessageType.Text, true, CancellationToken.None);
                _logger.LogDebug($"Sent message: {messageJson}");
            }
        }

        private async Task BroadcastMessageToRoomAsync(string roomCode, object message, string? excludePlayerId = null)
        {
            if (_rooms.TryGetValue(roomCode, out var room))
            {
                foreach (var player in room.Players)
                {
                    if (player.PlayerId != excludePlayerId)
                    {
                        await SendMessageAsync(player.Socket, message);
                    }
                }
            }
        }
    }
}
-------------------- END RoomManager.cs --------------------

-------------------- JudgeService.cs (path: apps/api/Services/JudgeService.cs) --------------------
using System.Net.Http;
using System.Net.Http.Json;
using System.Text;
using System.Text.Json;
using System.Text.Json.Serialization;
using System.Threading.Tasks;
using Microsoft.Extensions.Logging;
using Microsoft.Extensions.Options;
using MyCsApi.Models;

namespace MyCsApi.Services
{
    public interface IJudgeService
    {
        Task<JudgeSubmissionResult?> SubmitCodeAsync(string sourceCode, int languageId, string? stdin, string? expectedOutput);
    }

    public class JudgeService : IJudgeService
    {
        private readonly HttpClient _httpClient;
        private readonly Judge0Settings _judge0Settings;
        private readonly ILogger<JudgeService> _logger;
        private static readonly JsonSerializerOptions _jsonOptions = new() { PropertyNamingPolicy = JsonNamingPolicy.CamelCase };

        public JudgeService(HttpClient httpClient, IOptions<Judge0Settings> judge0Settings, ILogger<JudgeService> logger)
        {
            _httpClient = httpClient;
            _judge0Settings = judge0Settings.Value;
            _logger = logger;

            if (!string.IsNullOrEmpty(_judge0Settings.ApiKey))
            {
                _httpClient.DefaultRequestHeaders.Add("X-RapidAPI-Key", _judge0Settings.ApiKey);
            }
            if (!string.IsNullOrEmpty(_judge0Settings.ApiHost))
            {
                _httpClient.DefaultRequestHeaders.Add("X-RapidAPI-Host", _judge0Settings.ApiHost);
            }
        }

        public async Task<JudgeSubmissionResult?> SubmitCodeAsync(string sourceCode, int languageId, string? stdin, string? expectedOutput)
        {
            var submissionRequest = new JudgeSubmissionRequest
            {
                SourceCode = sourceCode,
                LanguageId = languageId,
                Stdin = stdin,
                ExpectedOutput = expectedOutput // Judge0 can compare this or you can do it manually
            };

            // Use wait=true to get the result directly, simplifies logic by avoiding polling
            var judge0Url = $"{_judge0Settings.ApiUrl.TrimEnd('/')}/submissions?base64_encoded=false&wait=true";
            _logger.LogInformation($"Submitting to Judge0: {judge0Url}");

            try
            {
                HttpResponseMessage response = await _httpClient.PostAsJsonAsync(judge0Url, submissionRequest, _jsonOptions);

                if (!response.IsSuccessStatusCode)
                {
                    var errorContent = await response.Content.ReadAsStringAsync();
                    _logger.LogError($"Judge0 API request failed with status {response.StatusCode}: {errorContent}");
                    return new JudgeSubmissionResult { Status = new JudgeStatus { Description = "Error communicating with Judge0" }, ErrorDetails = errorContent };
                }

                var result = await response.Content.ReadFromJsonAsync<JudgeSubmissionResult>(_jsonOptions);
                if (result != null)
                {
                    _logger.LogInformation($"Judge0 Result ({result.Status?.Description}): STDOUT: {result.Stdout}, STDERR: {result.Stderr}, Compile Output: {result.CompileOutput}");
                }
                return result;
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Exception occurred while submitting to Judge0.");
                return new JudgeSubmissionResult { Status = new JudgeStatus { Description = "Exception during Judge0 submission" }, ErrorDetails = ex.Message };
            }
        }


    }

    public class JudgeSubmissionRequest
    {
        [JsonPropertyName("source_code")]
        public string SourceCode { get; set; } = string.Empty;

        [JsonPropertyName("language_id")]
        public int LanguageId { get; set; }

        [JsonPropertyName("stdin")]
        public string? Stdin { get; set; }

        [JsonPropertyName("expected_output")]
        public string? ExpectedOutput { get; set; }
    }

    public class JudgeSubmissionResult
    {
        [JsonPropertyName("stdout")]
        public string? Stdout { get; set; }

        [JsonPropertyName("stderr")]
        public string? Stderr { get; set; }

        [JsonPropertyName("compile_output")]
        public string? CompileOutput { get; set; }

        [JsonPropertyName("message")] // For base64 encoded response messages
        public string? Message { get; set; }

        [JsonPropertyName("status")]
        public JudgeStatus? Status { get; set; }

        [JsonPropertyName("time")]
        public string? Time { get; set; } // Execution time in seconds

        [JsonPropertyName("memory")]
        public int? Memory { get; set; } // Memory in kilobytes

        public string? ErrorDetails { get; set; } // Custom field for our error tracking
    }

    public class JudgeStatus
    {
        [JsonPropertyName("id")]
        public int Id { get; set; }

        [JsonPropertyName("description")]
        public string Description { get; set; } = string.Empty;
    }
}
-------------------- END JudgeService.cs --------------------

-------------------- WebSocketMessageHandler.cs (path: apps/api/WebSockets/WebSocketMessageHandler.cs) --------------------
using System;
using System.Net.WebSockets;
using System.Text;
using System.Text.Json;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.Extensions.Logging;
using MyCsApi.Services;
using MyCsApi.Models;

namespace MyCsApi.WebSockets
{
    public class WebSocketMessageHandler
    {
        private readonly IRoomManager _roomManager;
        private readonly ICardManager _cardManager;
        private readonly ILogger<WebSocketMessageHandler> _logger;
        private static readonly JsonSerializerOptions _jsonSerializerOptions = new()
        {
            PropertyNameCaseInsensitive = true,
            PropertyNamingPolicy = JsonNamingPolicy.CamelCase
        };

        public WebSocketMessageHandler(IRoomManager roomManager, ICardManager cardManager, ILogger<WebSocketMessageHandler> logger)
        {
            _roomManager = roomManager;
            _cardManager = cardManager;
            _logger = logger;
        }

        public async Task HandleWebSocketAsync(WebSocket webSocket)
        {
            var playerId = Guid.NewGuid().ToString();
            _logger.LogInformation($"WebSocket connection established: {playerId}");

            var buffer = new byte[1024 * 4];
            WebSocketReceiveResult result;

            try
            {
                do
                {
                    result = await webSocket.ReceiveAsync(new ArraySegment<byte>(buffer), CancellationToken.None);
                    if (result.MessageType == WebSocketMessageType.Text && !result.CloseStatus.HasValue)
                    {
                        var messageJson = Encoding.UTF8.GetString(buffer, 0, result.Count);
                        _logger.LogInformation($"Received message from {playerId}: {messageJson}");

                        BaseWebSocketMessage? baseMessage = JsonSerializer.Deserialize<BaseWebSocketMessage>(messageJson, _jsonSerializerOptions);

                        if (baseMessage == null)
                        {
                            _logger.LogWarning($"Could not deserialize base message: {messageJson}");
                            continue;
                        }

                        switch (baseMessage.Type)
                        {
                            case "createRoom":
                                var createRoomMsg = JsonSerializer.Deserialize<CreateRoomClientMessage>(messageJson, _jsonSerializerOptions);
                                if (createRoomMsg != null)
                                    await _roomManager.CreateRoomAsync(webSocket, playerId, createRoomMsg.Payload.PlayerName);
                                break;
                            case "joinRoom":
                                var joinRoomMsg = JsonSerializer.Deserialize<JoinRoomClientMessage>(messageJson, _jsonSerializerOptions);
                                if (joinRoomMsg != null)
                                    await _roomManager.JoinRoomAsync(webSocket, playerId, joinRoomMsg.Payload.PlayerName, joinRoomMsg.Payload.RoomCode);
                                break;
                            case "useCard":
                                var useCardMsg = JsonSerializer.Deserialize<UseCardMessage>(messageJson, _jsonSerializerOptions);
                                if (useCardMsg != null)
                                    await _cardManager.UseCardAsync(webSocket, playerId, useCardMsg.Payload.CardName,
                                        useCardMsg.Payload.TargetPlayerId);
                                break;
                            case "startGame":
                                await _roomManager.StartGameAsync(playerId);
                                break;
                            default:
                                _logger.LogWarning($"Unknown message type from {playerId}: {baseMessage.Type}");
                                break;
                        }
                    }
                } while (!result.CloseStatus.HasValue);
            }
            catch (WebSocketException ex)
            {
                _logger.LogError($"WebSocketException for {playerId}: {ex.Message}");
            }
            catch (Exception ex)
            {
                _logger.LogError($"Exception for {playerId}: {ex.Message}");
            }
            finally
            {
                await _roomManager.PlayerDisconnectedAsync(playerId, webSocket);
                if (webSocket.State != WebSocketState.Closed && webSocket.State != WebSocketState.Aborted)
                {
                    await webSocket.CloseAsync(WebSocketCloseStatus.NormalClosure, "Connection closed by server", CancellationToken.None);
                }
                _logger.LogInformation($"WebSocket connection closed for player {playerId}");
            }
        }
    }
}
-------------------- END WebSocketMessageHandler.cs --------------------

-------------------- README.md (path: apps/api/README.md) --------------------
# api

To install dependencies:

```bash
bun install
```

To run:

```bash
bun run index.ts
```

This project was created using `bun init` in bun v1.2.13. [Bun](https://bun.sh) is a fast all-in-one JavaScript runtime.
-------------------- END README.md --------------------

-------------------- .npmrc (path: .npmrc) --------------------
-------------------- END .npmrc --------------------

-------------------- README.md (path: README.md) --------------------
# Turborepo starter

This Turborepo starter is maintained by the Turborepo core team.

## Using this example

Run the following command:

```sh
npx create-turbo@latest
```

## What's inside?

This Turborepo includes the following packages/apps:

### Apps and Packages

- `docs`: a [Next.js](https://nextjs.org/) app
- `web`: another [Next.js](https://nextjs.org/) app
- `@repo/ui`: a stub React component library shared by both `web` and `docs` applications
- `@repo/eslint-config`: `eslint` configurations (includes `eslint-config-next` and `eslint-config-prettier`)
- `@repo/typescript-config`: `tsconfig.json`s used throughout the monorepo

Each package/app is 100% [TypeScript](https://www.typescriptlang.org/).

### Utilities

This Turborepo has some additional tools already setup for you:

- [TypeScript](https://www.typescriptlang.org/) for static type checking
- [ESLint](https://eslint.org/) for code linting
- [Prettier](https://prettier.io) for code formatting

### Build

To build all apps and packages, run the following command:

```
cd my-turborepo
pnpm build
```

### Develop

To develop all apps and packages, run the following command:

```
cd my-turborepo
pnpm dev
```

### Remote Caching

> [!TIP]
> Vercel Remote Cache is free for all plans. Get started today at [vercel.com](https://vercel.com/signup?/signup?utm_source=remote-cache-sdk&utm_campaign=free_remote_cache).

Turborepo can use a technique known as [Remote Caching](https://turborepo.com/docs/core-concepts/remote-caching) to share cache artifacts across machines, enabling you to share build caches with your team and CI/CD pipelines.

By default, Turborepo will cache locally. To enable Remote Caching you will need an account with Vercel. If you don't have an account you can [create one](https://vercel.com/signup?utm_source=turborepo-examples), then enter the following commands:

```
cd my-turborepo
npx turbo login
```

This will authenticate the Turborepo CLI with your [Vercel account](https://vercel.com/docs/concepts/personal-accounts/overview).

Next, you can link your Turborepo to your Remote Cache by running the following command from the root of your Turborepo:

```
npx turbo link
```

## Useful Links

Learn more about the power of Turborepo:

- [Tasks](https://turborepo.com/docs/crafting-your-repository/running-tasks)
- [Caching](https://turborepo.com/docs/crafting-your-repository/caching)
- [Remote Caching](https://turborepo.com/docs/core-concepts/remote-caching)
- [Filtering](https://turborepo.com/docs/crafting-your-repository/running-tasks#using-filters)
- [Configuration Options](https://turborepo.com/docs/reference/configuration)
- [CLI Usage](https://turborepo.com/docs/reference/command-line-reference)
-------------------- END README.md --------------------

-------------------- turbo.json (path: turbo.json) --------------------
{
  "$schema": "https://turborepo.com/schema.json",
  "ui": "tui",
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "inputs": ["$TURBO_DEFAULT$", ".env*"],
      "outputs": [".next/**", "!.next/cache/**"]
    },
    "lint": {
      "dependsOn": ["^lint"]
    },
    "check-types": {
      "dependsOn": ["^check-types"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
-------------------- END turbo.json --------------------

-------------------- coderoyalereal.sln (path: coderoyalereal.sln) --------------------
Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.5.2.0
MinimumVisualStudioVersion = 10.0.40219.1
Project("{2150E333-8FDC-42A3-9474-1A3956D46DE8}") = "apps", "apps", "{1787FE1D-075E-9E68-7218-25F1BD1BBEAB}"
EndProject
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "MyCsApi", "apps\api\MyCsApi.csproj", "{4733770F-F634-73FE-47B0-B8304BD51A17}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{4733770F-F634-73FE-47B0-B8304BD51A17}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{4733770F-F634-73FE-47B0-B8304BD51A17}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{4733770F-F634-73FE-47B0-B8304BD51A17}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{4733770F-F634-73FE-47B0-B8304BD51A17}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(NestedProjects) = preSolution
		{4733770F-F634-73FE-47B0-B8304BD51A17} = {1787FE1D-075E-9E68-7218-25F1BD1BBEAB}
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {8AFC729D-C5A8-4E37-B8DF-6F143CCBCBE2}
	EndGlobalSection
EndGlobal
-------------------- END coderoyalereal.sln --------------------

